==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\background\index.ts
==========================================
/**
 * Background Service Worker
 * Chrome Extension??Î∞±Í∑∏?ºÏö¥???ÑÎ°ú?∏Ïä§
 */

// ============================================================
// ?¨Ïù¥???®ÎÑê ?§Ï†ï ?®Ïàò
// ============================================================

const setupSidePanel = () => {
  chrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true })
    .then(() => console.log('[Pockest] SidePanel behavior set successfully'))
    .catch((error) => console.error('[Pockest] SidePanel Setup Error:', error));
};

// ============================================================
// ?§Ïπò/?ÖÎç∞?¥Ìä∏ ?¥Î≤§??// ============================================================

chrome.runtime.onInstalled.addListener((details) => {
  console.log('[Pockest] Extension installed:', details.reason);
  
  // ?¨Ïù¥???®ÎÑê ?ôÏûë ?§Ï†ï
  setupSidePanel();

  if (details.reason === 'install') {
    // ÏµúÏ¥à ?§Ïπò ???òÏòÅ ?òÏù¥ÏßÄ(Welcome) ?¥Í∏∞
    console.log('[Pockest] Opening welcome page for new installation');
    chrome.tabs.create({
      url: chrome.runtime.getURL('index.html#/welcome'),
    });
  } else if (details.reason === 'update') {
    // ?ÖÎç∞?¥Ìä∏ ?úÏóê??Î°úÍ∑∏Îß?Ï∂úÎ†•
    console.log('[Pockest] Extension updated to version:', chrome.runtime.getManifest().version);
  }
});

// ============================================================
// Î∏åÎùº?∞Ï? ?úÏûë ?¥Î≤§??// ============================================================

chrome.runtime.onStartup.addListener(() => {
  console.log('[Pockest] Browser started, setting up side panel');
  setupSidePanel();
});

// ============================================================
// ?°ÏÖò ?¥Î¶≠ ?¥Î≤§??(?¨Ïù¥???®ÎÑê Í∞ïÏ†ú ?¥Í∏∞)
// ============================================================

chrome.action.onClicked.addListener(async (tab) => {
  console.log('[Pockest] Action clicked, opening side panel');
  
  // windowIdÎ°??¨Ïù¥???®ÎÑê ?¥Í∏∞ (???àÏ†ï??
  if (tab.windowId) {
    try {
      await chrome.sidePanel.open({ windowId: tab.windowId });
      console.log('[Pockest] Side panel opened via windowId');
    } catch (error) {
      console.error('[Pockest] Failed to open side panel:', error);
      
      // Fallback: tabIdÎ°??úÎèÑ
      if (tab.id) {
        try {
          await chrome.sidePanel.open({ tabId: tab.id });
          console.log('[Pockest] Side panel opened via tabId (fallback)');
        } catch (fallbackError) {
          console.error('[Pockest] Fallback also failed:', fallbackError);
        }
      }
    }
  }
});

// ============================================================
// Î©îÏãúÏßÄ ?∏Îì§??// ============================================================

chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  switch (message.type) {
    case 'SAVE_ITEM':
      handleSaveItem(message.payload)
        .then((result) => sendResponse({ success: true, data: result }))
        .catch((error) => sendResponse({ success: false, error: error.message }));
      return true; // ÎπÑÎèôÍ∏??ëÎãµ

    case 'GET_PAGE_INFO':
      // Content Script???îÏ≤≠ ?ÑÎã¨
      if (sender.tab?.id) {
        chrome.tabs.sendMessage(sender.tab.id, { type: 'GET_PAGE_INFO' }, sendResponse);
      }
      return true;

    case 'AUTH_STATE_CHANGED':
      // ?∏Ï¶ù ?ÅÌÉú Î≥ÄÍ≤???Î™®Îì† ??óê ?åÎ¶º
      broadcastMessage({ type: 'AUTH_STATE_CHANGED', payload: message.payload });
      break;

    case 'PRODUCT_PAGE_DETECTED':
      console.log('[Pockest] Product page detected:', message.payload?.url);
      break;

    default:
      console.log('[Pockest] Unknown message type:', message.type);
  }
});

// ============================================================
// ?¨Ìçº ?®Ïàò
// ============================================================

// ?ÅÌíà ?Ä???∏Îì§??async function handleSaveItem(item: unknown) {
  console.log('[Pockest] Save item request:', item);
  return item;
}

// Î™®Îì† ??óê Î©îÏãúÏßÄ Î∏åÎ°ú?úÏ∫ê?§Ìä∏
function broadcastMessage(message: unknown) {
  chrome.tabs.query({}, (tabs) => {
    tabs.forEach((tab) => {
      if (tab.id) {
        chrome.tabs.sendMessage(tab.id, message).catch(() => {
          // ??óê content scriptÍ∞Ä ?ÜÎäî Í≤ΩÏö∞ Î¨¥Ïãú
        });
      }
    });
  });
}

console.log('[Pockest] Background service worker started');

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\layout\Header.tsx
==========================================
import React from 'react';
import { Search, Bell, User } from 'lucide-react';
import { cn } from '@/utils';
import { Input } from '@/components/ui';

interface HeaderProps {
  onSearch?: (query: string) => void;
  className?: string;
}

export function Header({ onSearch, className }: HeaderProps) {
  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
    onSearch?.(e.target.value);
  };

  return (
    <header
      className={cn(
        'h-16 px-6 flex items-center justify-between gap-4',
        'bg-white border-b border-gray-100',
        className
      )}
    >
      {/* Î°úÍ≥† */}
      <div className="flex items-center gap-3">
        <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center">
          <span className="text-white font-bold text-sm">P</span>
        </div>
        <span className="font-semibold text-gray-900 text-lg">Pockest</span>
      </div>

      {/* Í≤Ä??*/}
      <div className="flex-1 max-w-md">
        <Input
          type="search"
          placeholder="?ÅÌíà Í≤Ä??.."
          leftIcon={<Search className="w-4 h-4" />}
          onChange={handleSearch}
        />
      </div>

      {/* ?∞Ï∏° ?°ÏÖò */}
      <div className="flex items-center gap-2">
        <button className="p-2 rounded-lg hover:bg-gray-100 transition-colors">
          <Bell className="w-5 h-5 text-gray-500" />
        </button>
        <button className="p-2 rounded-lg hover:bg-gray-100 transition-colors">
          <User className="w-5 h-5 text-gray-500" />
        </button>
      </div>
    </header>
  );
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\layout\index.ts
==========================================
export * from './Header';
export * from './Sidebar';






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\layout\Sidebar.tsx
==========================================
import React from 'react';
import {
  Home,
  Clock,
  Star,
  Trash2,
  Plus,
  Settings,
} from 'lucide-react';
import { cn } from '@/utils';
import { PocketItem } from '@/components/PocketItem';
import type { PocketWithCount } from '@/types';

interface SidebarProps {
  pockets: PocketWithCount[];
  selectedPocketId: string | null;
  onSelectPocket: (id: string | null) => void;
  onCreatePocket: () => void;
  currentView: 'all' | 'today' | 'pinned' | 'trash' | 'pocket';
  onViewChange: (view: 'all' | 'today' | 'pinned' | 'trash') => void;
  className?: string;
}

interface NavItemProps {
  icon: React.ReactNode;
  label: string;
  active?: boolean;
  onClick?: () => void;
  badge?: number;
}

function NavItem({ icon, label, active, onClick, badge }: NavItemProps) {
  return (
    <button
      onClick={onClick}
      className={cn(
        'w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium',
        'transition-colors duration-150',
        active
          ? 'bg-primary-50 text-primary-700'
          : 'text-gray-600 hover:bg-gray-100'
      )}
    >
      {icon}
      <span className="flex-1 text-left">{label}</span>
      {badge !== undefined && badge > 0 && (
        <span className="px-2 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600">
          {badge}
        </span>
      )}
    </button>
  );
}

export function Sidebar({
  pockets,
  selectedPocketId,
  onSelectPocket,
  onCreatePocket,
  currentView,
  onViewChange,
  className,
}: SidebarProps) {
  return (
    <aside
      className={cn(
        'w-64 h-full bg-white border-r border-gray-100',
        'flex flex-col',
        className
      )}
    >
      {/* Î©îÏù∏ ?§ÎπÑÍ≤åÏù¥??*/}
      <nav className="flex-1 p-4 space-y-1">
        <NavItem
          icon={<Home className="w-5 h-5" />}
          label="Î™®Îì† ?ÅÌíà"
          active={currentView === 'all'}
          onClick={() => {
            onSelectPocket(null);
            onViewChange('all');
          }}
        />
        <NavItem
          icon={<Clock className="w-5 h-5" />}
          label="?§Îäò ?Ä??
          active={currentView === 'today'}
          onClick={() => onViewChange('today')}
        />
        <NavItem
          icon={<Star className="w-5 h-5" />}
          label="Ï¶êÍ≤®Ï∞æÍ∏∞"
          active={currentView === 'pinned'}
          onClick={() => onViewChange('pinned')}
        />

        {/* ?¥Îçî ?πÏÖò */}
        <div className="pt-4 mt-4 border-t border-gray-100">
          <div className="flex items-center justify-between px-3 mb-2">
            <span className="text-xs font-semibold text-gray-400 uppercase tracking-wider">
              ?¥Îçî
            </span>
            <button
              onClick={onCreatePocket}
              className="p-1 rounded hover:bg-gray-100 transition-colors"
            >
              <Plus className="w-4 h-4 text-gray-400" />
            </button>
          </div>

          <div className="space-y-1">
            {pockets.map((pocket) => (
              <PocketItem
                key={pocket.id}
                pocket={pocket}
                isActive={selectedPocketId === pocket.id}
                onClick={(pocketId) => {
                  onSelectPocket(pocketId);
                  onViewChange('all');
                }}
                className="px-0"
              />
            ))}
          </div>
        </div>

        {/* ?¥Ï???*/}
        <div className="pt-4 mt-4 border-t border-gray-100">
          <NavItem
            icon={<Trash2 className="w-5 h-5" />}
            label="?¥Ï???
            active={currentView === 'trash'}
            onClick={() => onViewChange('trash')}
          />
        </div>
      </nav>

      {/* ?òÎã® ?§Ï†ï */}
      <div className="p-4 border-t border-gray-100">
        <NavItem
          icon={<Settings className="w-5 h-5" />}
          label="?§Ï†ï"
        />
      </div>
    </aside>
  );
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\Button.tsx
==========================================
import React from 'react';
import { cn } from '@/utils';

type ButtonVariant = 'primary' | 'secondary' | 'ghost' | 'danger';
type ButtonSize = 'sm' | 'md' | 'lg';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: ButtonVariant;
  size?: ButtonSize;
  isLoading?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

const variantStyles: Record<ButtonVariant, string> = {
  primary:
    'bg-violet-500 text-white hover:bg-violet-600 active:bg-violet-700 focus:ring-violet-400 shadow-lg shadow-violet-200',
  secondary:
    'bg-gray-100 text-gray-700 hover:bg-gray-200 active:bg-gray-300 focus:ring-gray-300',
  ghost:
    'bg-transparent text-gray-600 hover:bg-gray-100 active:bg-gray-200 focus:ring-gray-300',
  danger:
    'bg-red-500 text-white hover:bg-red-600 active:bg-red-700 focus:ring-red-400',
};

const sizeStyles: Record<ButtonSize, string> = {
  sm: 'px-3 py-1.5 text-sm',
  md: 'px-4 py-2 text-sm',
  lg: 'px-6 py-3 text-base',
};

export function Button({
  variant = 'primary',
  size = 'md',
  isLoading = false,
  leftIcon,
  rightIcon,
  className,
  disabled,
  children,
  ...props
}: ButtonProps) {
  return (
    <button
      className={cn(
        'inline-flex items-center justify-center gap-2 rounded-lg font-medium',
        'transition-colors duration-150 ease-in-out',
        'focus:outline-none focus:ring-2 focus:ring-offset-2',
        'disabled:cursor-not-allowed disabled:opacity-50',
        variantStyles[variant],
        sizeStyles[size],
        className
      )}
      disabled={disabled || isLoading}
      {...props}
    >
      {isLoading ? (
        <svg
          className="h-4 w-4 animate-spin"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            className="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            strokeWidth="4"
          />
          <path
            className="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          />
        </svg>
      ) : (
        leftIcon
      )}
      {children}
      {!isLoading && rightIcon}
    </button>
  );
}



==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\Card.tsx
==========================================
import React from 'react';
import { cn } from '@/utils';

interface CardProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function Card({ className, children, ...props }: CardProps) {
  return (
    <div
      className={cn(
        'rounded-xl bg-white shadow-sm border border-gray-100',
        'transition-shadow duration-200 hover:shadow-md',
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
}

interface CardHeaderProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function CardHeader({ className, children, ...props }: CardHeaderProps) {
  return (
    <div
      className={cn('px-4 py-3 border-b border-gray-100', className)}
      {...props}
    >
      {children}
    </div>
  );
}

interface CardContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function CardContent({ className, children, ...props }: CardContentProps) {
  return (
    <div className={cn('p-4', className)} {...props}>
      {children}
    </div>
  );
}

interface CardFooterProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function CardFooter({ className, children, ...props }: CardFooterProps) {
  return (
    <div
      className={cn('px-4 py-3 border-t border-gray-100 bg-gray-50 rounded-b-xl', className)}
      {...props}
    >
      {children}
    </div>
  );
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\index.ts
==========================================
export * from './Button';
export * from './Card';
export * from './Input';
export * from './ItemCard';
export * from './Toast';



==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\Input.tsx
==========================================
import React, { forwardRef } from 'react';
import { cn } from '@/utils';

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ className, label, error, leftIcon, rightIcon, ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="block text-sm font-medium text-gray-700 mb-1.5">
            {label}
          </label>
        )}
        <div className="relative">
          {leftIcon && (
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
              {leftIcon}
            </div>
          )}
          <input
            ref={ref}
            className={cn(
              'w-full rounded-lg border border-gray-300 bg-white',
              'px-4 py-2.5 text-sm text-gray-900 placeholder-gray-400',
              'transition-colors duration-150',
              'focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none',
              'disabled:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60',
              error && 'border-red-500 focus:border-red-500 focus:ring-red-500/20',
              leftIcon && 'pl-10',
              rightIcon && 'pr-10',
              className
            )}
            {...props}
          />
          {rightIcon && (
            <div className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400">
              {rightIcon}
            </div>
          )}
        </div>
        {error && <p className="mt-1.5 text-sm text-red-600">{error}</p>}
      </div>
    );
  }
);

Input.displayName = 'Input';






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\ItemCard.tsx
==========================================
import { ShoppingBag, Star, X } from 'lucide-react';
import { cn, formatPrice } from '@/utils';

interface ItemCardProps {
  title: string;
  price?: number | null;
  currency?: string;
  imageUrl?: string | null;
  siteName?: string | null;
  isPinned?: boolean;
  variant?: 'list' | 'grid';
  showDelete?: boolean;
  showPin?: boolean;
  onClick?: () => void;
  onDelete?: () => void;
  onTogglePin?: () => void;
}

export function ItemCard({
  title,
  price,
  currency = 'KRW',
  imageUrl,
  siteName,
  isPinned = false,
  variant = 'list',
  showDelete = false,
  showPin = false,
  onClick,
  onDelete,
  onTogglePin,
}: ItemCardProps) {
  // Î¶¨Ïä§??Î∑?(?îÏûê???úÏïà Í∏∞Ï?)
  if (variant === 'list') {
    return (
      <div
        className="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
        onClick={onClick}
      >
        {/* ?ÅÌíà ?¥Î?ÏßÄ */}
        <div className="w-14 h-14 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0">
          {imageUrl ? (
            <img
              src={imageUrl}
              alt={title}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full flex items-center justify-center">
              <ShoppingBag className="w-6 h-6 text-gray-300" />
            </div>
          )}
        </div>

        {/* ?ÅÌíà ?ïÎ≥¥ */}
        <div className="flex-1 min-w-0">
          {siteName && (
            <p className="text-xs text-gray-400 mb-0.5">{siteName}</p>
          )}
          <p className="font-medium text-gray-900 text-sm truncate">{title}</p>
          {price != null && (
            <p className="text-sm font-bold text-gray-900 mt-0.5">
              {formatPrice(price, currency)}
            </p>
          )}
        </div>

        {/* ?°ÏÖò Î≤ÑÌäº??*/}
        <div className="flex items-center gap-1">
          {showPin && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onTogglePin?.();
              }}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <Star
                className={cn(
                  'w-4 h-4 transition-colors',
                  isPinned
                    ? 'fill-amber-400 text-amber-400'
                    : 'text-gray-300 hover:text-amber-400'
                )}
              />
            </button>
          )}
          {showDelete && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onDelete?.();
              }}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <X className="w-4 h-4 text-gray-400" />
            </button>
          )}
        </div>
      </div>
    );
  }

  // Í∑∏Î¶¨??Î∑?(Pinterest ?§Ì???
  return (
    <div
      className="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md cursor-pointer transition-all"
      onClick={onClick}
    >
      {/* ?ÅÌíà ?¥Î?ÏßÄ */}
      <div className="aspect-square bg-gray-100 relative overflow-hidden">
        {imageUrl ? (
          <img
            src={imageUrl}
            alt={title}
            className="w-full h-full object-cover"
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <ShoppingBag className="w-8 h-8 text-gray-300" />
          </div>
        )}
        
        {/* ?Ä Î≤ÑÌäº ?§Î≤Ñ?àÏù¥ */}
        {showPin && (
          <button
            onClick={(e) => {
              e.stopPropagation();
              onTogglePin?.();
            }}
            className="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/90 shadow flex items-center justify-center hover:bg-white transition-colors"
          >
            <Star
              className={cn(
                'w-4 h-4 transition-colors',
                isPinned
                  ? 'fill-amber-400 text-amber-400'
                  : 'text-gray-400 hover:text-amber-400'
              )}
            />
          </button>
        )}
      </div>

      {/* ?ÅÌíà ?ïÎ≥¥ */}
      <div className="p-3">
        {siteName && (
          <p className="text-xs text-violet-500 font-medium truncate mb-0.5">{siteName}</p>
        )}
        <p className="font-medium text-gray-900 text-sm line-clamp-2 min-h-[2.5rem]">
          {title}
        </p>
        {price != null && (
          <p className="text-base font-bold text-gray-900 mt-1">
            {formatPrice(price, currency)}
          </p>
        )}
      </div>
    </div>
  );
}


==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\ui\Toast.tsx
==========================================
import { useEffect, useState } from 'react';
import { CheckCircle, XCircle, AlertCircle, X } from 'lucide-react';
import { cn } from '@/utils';

export type ToastType = 'success' | 'error' | 'warning';

interface ToastProps {
  message: string;
  type?: ToastType;
  duration?: number;
  onClose: () => void;
}

const icons = {
  success: CheckCircle,
  error: XCircle,
  warning: AlertCircle,
};

const styles = {
  success: 'bg-green-50 border-green-200 text-green-800',
  error: 'bg-red-50 border-red-200 text-red-800',
  warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
};

const iconStyles = {
  success: 'text-green-500',
  error: 'text-red-500',
  warning: 'text-yellow-500',
};

export function Toast({ message, type = 'success', duration = 3000, onClose }: ToastProps) {
  const [isVisible, setIsVisible] = useState(true);
  const Icon = icons[type];

  useEffect(() => {
    const timer = setTimeout(() => {
      setIsVisible(false);
      setTimeout(onClose, 200);
    }, duration);

    return () => clearTimeout(timer);
  }, [duration, onClose]);

  return (
    <div
      className={cn(
        'fixed bottom-4 left-1/2 -translate-x-1/2 z-50',
        'flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg',
        'transition-all duration-200',
        isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-2',
        styles[type]
      )}
    >
      <Icon className={cn('w-5 h-5', iconStyles[type])} />
      <span className="text-sm font-medium">{message}</span>
      <button
        onClick={() => {
          setIsVisible(false);
          setTimeout(onClose, 200);
        }}
        className="p-1 hover:bg-black/5 rounded"
      >
        <X className="w-4 h-4" />
      </button>
    </div>
  );
}

// Toast ?ÅÌÉú Í¥ÄÎ¶???interface ToastState {
  message: string;
  type: ToastType;
}

export function useToast() {
  const [toast, setToast] = useState<ToastState | null>(null);

  const showToast = (message: string, type: ToastType = 'success') => {
    setToast({ message, type });
  };

  const hideToast = () => {
    setToast(null);
  };

  return { toast, showToast, hideToast };
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\index.ts
==========================================
export * from './ui';
export * from './layout';
export * from './PocketItem';






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\components\PocketItem.tsx
==========================================
import React from 'react';
import { Folder } from 'lucide-react';
import { cn } from '@/utils';
import type { PocketWithCount } from '@/types';

interface PocketItemProps {
  pocket: PocketWithCount;
  
  // Popup?? ?ÅÌíà ?Ä??Í∏∞Îä•
  onSave?: (pocketId: string) => void;
  isSelected?: boolean;
  isSaving?: boolean;
  showSaveButton?: boolean;
  
  // Sidebar?? ?Ä?úÎ≥¥???¥Îèô
  onClick?: (pocketId: string) => void;
  isActive?: boolean;
  
  // Í≥µÌÜµ
  className?: string;
}

export function PocketItem({
  pocket,
  onSave,
  isSelected = false,
  isSaving = false,
  showSaveButton = false,
  onClick,
  isActive = false,
  className,
}: PocketItemProps) {
  const itemCount = pocket.item_count ?? 0;
  const thumbnails = pocket.recent_thumbnails ?? [];

  const handleClick = () => {
    if (onClick) {
      onClick(pocket.id);
    } else if (onSave && showSaveButton) {
      // Popup Î™®Îìú: ?Ä???ôÏûë
      onSave(pocket.id);
    } else {
      // Í∏∞Î≥∏: ?Ä?úÎ≥¥?úÎ°ú ?¥Îèô
      if (typeof chrome !== 'undefined' && chrome.tabs) {
        chrome.tabs.create({ 
          url: chrome.runtime.getURL(`index.html#/dashboard/${pocket.id}`) 
        });
      }
    }
  };

  const handleSaveClick = (e: React.MouseEvent) => {
    e.stopPropagation();
    if (onSave) {
      onSave(pocket.id);
    }
  };

  return (
    <div
      onClick={handleClick}
      className={cn(
        'group flex items-center gap-3 px-4 py-2.5 rounded-lg cursor-pointer transition-colors',
        isActive 
          ? 'bg-violet-50 text-violet-700' 
          : 'hover:bg-gray-50',
        className
      )}
    >
      {/* ?∏ÎÑ§??- Ï¢åÏ∏° Í≥†Ï†ï, ?ëÍ≤å */}
      <div className="w-10 h-10 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
        {thumbnails.length > 0 && thumbnails[0] ? (
          <img 
            src={thumbnails[0]} 
            alt="" 
            className="w-full h-full object-cover" 
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <Folder className="w-4 h-4 text-gray-300" />
          </div>
        )}
      </div>

      {/* ?¨ÏºìÎ™?+ Í∞?àò - Ï§ëÏïô */}
      <div className="flex-1 min-w-0 flex items-center gap-2">
        <p className={cn(
          'font-medium text-sm truncate',
          isActive ? 'text-violet-700' : 'text-gray-900'
        )}>
          {pocket.name}
        </p>
        <span className="text-xs text-gray-400 flex-shrink-0">
          {itemCount}Í∞?
        </span>
      </div>

      {/* ?¥Í∏∞ Î≤ÑÌäº - ?∞Ï∏°, hover ?úÏóêÎß??úÏãú */}
      {showSaveButton && onSave && (
        <div className="flex-shrink-0">
          {isSaving && isSelected ? (
            <div className="animate-spin w-4 h-4 border-2 border-violet-500 border-t-transparent rounded-full" />
          ) : (
            <button
              onClick={handleSaveClick}
              className={cn(
                'px-4 py-2 text-sm font-semibold rounded-lg transition-all',
                'invisible group-hover:visible',
                isSelected
                  ? 'bg-violet-600 text-white shadow-md'
                  : 'bg-indigo-50 text-indigo-600 hover:bg-indigo-100'
              )}
            >
              ?¥Í∏∞
            </button>
          )}
        </div>
      )}

      {/* Í∏∞Î≥∏ ?¥Îçî ?úÏãú (Sidebar?? */}
      {!showSaveButton && pocket.is_default && (
        <span className="text-xs text-gray-400 flex-shrink-0">Í∏∞Î≥∏</span>
      )}
    </div>
  );
}


==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\hooks\index.ts
==========================================
export * from './useAuth';
export * from './usePockets';
export * from './useItems';






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\hooks\useAuth.ts
==========================================
import { useEffect } from 'react';
import { useAuthStore } from '@/store/useAuthStore';
import { onAuthStateChange } from '@/services/supabase/client';

/**
 * ?∏Ï¶ù Í¥Ä??Ïª§Ïä§?Ä ?? * Email/Password ?∏Ï¶ùÎß?ÏßÄ?? */
export function useAuth() {
  const {
    user,
    status,
    error,
    initialize,
    signInWithEmail,
    signUpWithEmail,
    signOut,
    clearError,
  } = useAuthStore();

  // Ï¥àÍ∏∞??Î∞??∏Ï¶ù ?ÅÌÉú Î¶¨Ïä§???§Ï†ï
  useEffect(() => {
    initialize();

    const { data: subscription } = onAuthStateChange((event) => {
      if (event === 'SIGNED_OUT') {
        useAuthStore.setState({
          user: null,
          status: 'unauthenticated',
        });
      } else if (event === 'SIGNED_IN') {
        // ?∏ÏÖò??Î≥ÄÍ≤ΩÎêòÎ©??§Ïãú Ï¥àÍ∏∞??        initialize();
      }
    });

    return () => {
      subscription.subscription.unsubscribe();
    };
  }, [initialize]);

  return {
    // State
    user,
    isAuthenticated: status === 'authenticated',
    isLoading: status === 'loading',
    error,

    // Derived
    isPremium: user?.tier === 'premium',

    // Actions (Email/Password only)
    signIn: signInWithEmail,
    signUp: signUpWithEmail,
    signOut,
    clearError,
  };
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\hooks\useItems.ts
==========================================
import { useCallback, useEffect } from 'react';
import { usePocketStore } from '@/store/usePocketStore';
import type { ItemFilters } from '@/types';

/**
 * ?ÅÌíà Í¥Ä??Ïª§Ïä§?Ä ??
 */
export function useItems() {
  const {
    items,
    itemsLoading,
    itemsTotal,
    currentPage,
    pageSize,
    filters,
    fetchItems,
    fetchTodayItems,
    addItem,
    updateItem,
    moveToTrash,
    restoreFromTrash,
    permanentDelete,
    togglePin,
    setFilters,
    clearFilters,
    setPage,
  } = usePocketStore();

  // Ï¥àÍ∏∞ Î°úÎìú ?úÍ±∞ (Î∂ÄÎ™?Ïª¥Ìè¨?åÌä∏?êÏÑú ?∏Ï¶ù ??Î™ÖÏãú?ÅÏúºÎ°??∏Ï∂ú)
  // useEffect(() => {
  //   fetchItems();
  // }, []);

  // ?òÏù¥ÏßÄ?§Ïù¥???ïÎ≥¥
  const totalPages = Math.ceil(itemsTotal / pageSize);
  const hasNextPage = currentPage < totalPages;
  const hasPrevPage = currentPage > 1;

  // ?ÑÌÑ∞ ?ÅÏö©
  const applyFilters = useCallback(
    (newFilters: Partial<ItemFilters>) => {
      setFilters(newFilters);
    },
    [setFilters]
  );

  // Í≤Ä??
  const search = useCallback(
    (query: string) => {
      setFilters({ search: query || undefined });
    },
    [setFilters]
  );

  // Ï¶êÍ≤®Ï∞æÍ∏∞Îß?Î≥¥Í∏∞
  const showPinnedOnly = useCallback(
    (pinned: boolean) => {
      setFilters({ isPinned: pinned ? true : undefined });
    },
    [setFilters]
  );

  return {
    // State
    items,
    loading: itemsLoading,
    total: itemsTotal,
    currentPage,
    totalPages,
    hasNextPage,
    hasPrevPage,
    filters,

    // Actions
    refresh: fetchItems,
    fetchToday: fetchTodayItems,
    add: addItem,
    update: updateItem,
    trash: moveToTrash,
    restore: restoreFromTrash,
    delete: permanentDelete,
    togglePin,

    // Filters
    applyFilters,
    clearFilters,
    search,
    showPinnedOnly,

    // Pagination
    goToPage: setPage,
    nextPage: () => hasNextPage && setPage(currentPage + 1),
    prevPage: () => hasPrevPage && setPage(currentPage - 1),
  };
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\hooks\usePockets.ts
==========================================
import { useCallback, useEffect } from 'react';
import { usePocketStore } from '@/store/usePocketStore';

/**
 * ?¥Îçî(Pocket) Í¥Ä??Ïª§Ïä§?Ä ??
 */
export function usePockets() {
  const {
    pockets,
    selectedPocketId,
    pocketsLoading,
    fetchPockets,
    createPocket,
    updatePocket,
    deletePocket,
    selectPocket,
  } = usePocketStore();

  // Ï¥àÍ∏∞ Î°úÎìú ?úÍ±∞ (Î∂ÄÎ™?Ïª¥Ìè¨?åÌä∏?êÏÑú ?∏Ï¶ù ??Î™ÖÏãú?ÅÏúºÎ°??∏Ï∂ú)
  // useEffect(() => {
  //   fetchPockets();
  // }, []);

  // Í∏∞Î≥∏ ?¥Îçî Ï∞æÍ∏∞
  const defaultPocket = pockets.find((p) => p.is_default);

  // ?ÑÏû¨ ?†ÌÉù???¥Îçî
  const selectedPocket = selectedPocketId
    ? pockets.find((p) => p.id === selectedPocketId)
    : null;

  // ???¥Îçî ?ùÏÑ± ???†ÌÉù
  const createAndSelect = useCallback(
    async (name: string) => {
      const pocket = await createPocket(name);
      if (pocket) {
        selectPocket(pocket.id);
      }
      return pocket;
    },
    [createPocket, selectPocket]
  );

  // ?¥Îçî ?¥Î¶Ñ Î≥ÄÍ≤?
  const rename = useCallback(
    async (id: string, newName: string) => {
      await updatePocket(id, newName);
    },
    [updatePocket]
  );

  // ?¥Îçî ??†ú (Í∏∞Î≥∏ ?¥Îçî????†ú Î∂àÍ?)
  const remove = useCallback(
    async (id: string) => {
      const pocket = pockets.find((p) => p.id === id);
      if (pocket?.is_default) {
        console.warn('Cannot delete default pocket');
        return false;
      }
      await deletePocket(id);
      return true;
    },
    [pockets, deletePocket]
  );

  return {
    // State
    pockets,
    loading: pocketsLoading,
    selectedPocketId,
    selectedPocket,
    defaultPocket,

    // Actions
    refresh: fetchPockets,
    create: createPocket,
    createAndSelect,
    rename,
    remove,
    select: selectPocket,

    // Î™®Îì† ?¥Îçî Î≥¥Í∏∞ (?†ÌÉù ?¥Ï†ú)
    selectAll: () => selectPocket(null),
  };
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\content\index.tsx
==========================================
/**
 * Content Script
 * ?ºÌïëÎ™??òÏù¥ÏßÄ?êÏÑú ?ÅÌíà ?ïÎ≥¥Î•?Ï∂îÏ∂ú?òÍ≥† ExtensionÍ≥??µÏã†
 */

import { parseProductFromPage, isProductPage, type ProductData } from '@/utils/parser';

// ============================================================
// ?Ä???ïÏùò
// ============================================================

interface ScrapeResponse {
  success: boolean;
  data: ProductData | null;
  error?: string;
}

type MessageType = 'SCRAPE_PRODUCT' | 'GET_PAGE_INFO' | 'CHECK_PRODUCT_PAGE';

interface ExtensionMessage {
  type: MessageType;
  payload?: unknown;
}

// ============================================================
// Î©îÏãúÏßÄ ?∏Îì§??// ============================================================

/**
 * Chrome Runtime Î©îÏãúÏßÄ Î¶¨Ïä§?? * Popup?¥ÎÇò Background?êÏÑú ?îÏ≤≠??Î∞õÏïÑ Ï≤òÎ¶¨
 */
chrome.runtime.onMessage.addListener(
  (
    message: ExtensionMessage,
    _sender: chrome.runtime.MessageSender,
    sendResponse: (response: ScrapeResponse | boolean | ProductData) => void
  ) => {
    switch (message.type) {
      case 'SCRAPE_PRODUCT':
        handleScrapeProduct(sendResponse);
        return true; // ÎπÑÎèôÍ∏??ëÎãµ???ÑÌï¥ true Î∞òÌôò

      case 'GET_PAGE_INFO':
        handleGetPageInfo(sendResponse);
        return true;

      case 'CHECK_PRODUCT_PAGE':
        sendResponse(isProductPage(document));
        return false;

      default:
        console.log('[Pockest] Unknown message type:', message.type);
        return false;
    }
  }
);

/**
 * ?ÅÌíà ?ïÎ≥¥ ?§ÌÅ¨?òÌïë ?∏Îì§?? */
function handleScrapeProduct(
  sendResponse: (response: ScrapeResponse) => void
): void {
  try {
    const productData = parseProductFromPage(document);
    
    // ÏµúÏÜå?úÏùò ?∞Ïù¥??Í≤ÄÏ¶?    if (!productData.title && !productData.imageUrl) {
      sendResponse({
        success: false,
        data: null,
        error: '?ÅÌíà ?ïÎ≥¥Î•?Ï∞æÏùÑ ???ÜÏäµ?àÎã§.',
      });
      return;
    }

    sendResponse({
      success: true,
      data: productData,
    });
  } catch (error) {
    console.error('[Pockest] Scrape error:', error);
    sendResponse({
      success: false,
      data: null,
      error: error instanceof Error ? error.message : '?åÏã± Ï§??§Î•òÍ∞Ä Î∞úÏÉù?àÏäµ?àÎã§.',
    });
  }
}

/**
 * ?òÏù¥ÏßÄ Í∏∞Î≥∏ ?ïÎ≥¥ Î∞òÌôò (Í∞ÑÎã® Î≤ÑÏ†Ñ)
 */
function handleGetPageInfo(
  sendResponse: (response: ProductData) => void
): void {
  try {
    const productData = parseProductFromPage(document);
    sendResponse(productData);
  } catch (error) {
    console.error('[Pockest] GetPageInfo error:', error);
    // ?§Î•ò ??Í∏∞Î≥∏Í∞?Î∞òÌôò
    sendResponse({
      title: document.title || '',
      price: null,
      currency: 'KRW',
      imageUrl: '',
      imageUrls: [],
      mallName: window.location.hostname.replace('www.', ''),
      url: window.location.href,
    });
  }
}

// ============================================================
// Ï¥àÍ∏∞??// ============================================================

/**
 * Content Script Î°úÎìú ??Ï¥àÍ∏∞?? */
function initialize(): void {
  // ?ÅÌíà ?òÏù¥ÏßÄ ?¨Î? Î°úÍπÖ (?îÎ≤ÑÍπÖÏö©)
  const isProduct = isProductPage(document);
  console.log('[Pockest] Content script loaded', {
    url: window.location.href,
    isProductPage: isProduct,
  });

  // ?ÅÌíà ?òÏù¥ÏßÄ??Í≤ΩÏö∞ Background???åÎ¶º (?†ÌÉù??
  if (isProduct) {
    chrome.runtime.sendMessage({
      type: 'PRODUCT_PAGE_DETECTED',
      payload: { url: window.location.href },
    }).catch(() => {
      // BackgroundÍ∞Ä ?ÜÎäî Í≤ΩÏö∞ Î¨¥Ïãú
    });
  }
}

// DOM Î°úÎìú ?ÑÎ£å ??Ï¥àÍ∏∞??if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initialize);
} else {
  initialize();
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\dashboard\Dashboard.tsx
==========================================
import { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { useAuth, usePockets, useItems } from '@/hooks';
import { usePocketStore } from '@/store/usePocketStore';
import { Header, Sidebar } from '@/components/layout';
import { Card, CardContent, Button, Input } from '@/components/ui';
import { Star, Trash2, ExternalLink, Mail, Lock } from 'lucide-react';
import { cn, formatPrice, formatRelativeTime } from '@/utils';

type ViewType = 'all' | 'today' | 'pinned' | 'trash';

export default function Dashboard() {
  console.log('[Dashboard] ?? Component mounting...');

  const { pocketId } = useParams<{ pocketId?: string }>();
  const { t } = useTranslation();
  const { user, isAuthenticated, isLoading: authLoading, signIn, signUp, error, clearError } = useAuth();
  const { pockets, selectedPocketId, select: selectPocket } = usePockets();
  const { items, loading: itemsLoading, togglePin, trash, search, fetchToday, refresh, showPinnedOnly } = useItems();
  
  const [currentView, setCurrentView] = useState<ViewType>('all');

  // ?îÎ≤ÑÍπÖÏö© Î°úÍ∑∏
  console.log('[Dashboard] ?ìä Render state:', { 
    isAuthenticated,
    authLoading,
    user: user?.email,
    currentView, 
    itemsLoading, 
    itemsCount: items?.length,
    pocketsCount: pockets?.length,
    isItemsArray: Array.isArray(items),
    hasItems: items && items.length > 0
  });

  // ?∏Ï¶ù ?ÑÎ£å ??Ï¥àÍ∏∞ ?∞Ïù¥??Î°úÎìú
  useEffect(() => {
    if (!isAuthenticated) {
      console.log('[Dashboard] ?†Ô∏è Not authenticated, skipping initial data load');
      return;
    }

    console.log('[Dashboard] ?îÑ Authenticated! Loading initial data...');
    const loadInitialData = async () => {
      try {
        await Promise.all([
          usePocketStore.getState().fetchPockets(),
          refresh()
        ]);
        console.log('[Dashboard] ?éâ Initial data loaded');
      } catch (err) {
        console.error('[Dashboard] ??Error loading initial data:', err);
      }
    };

    loadInitialData();
  }, [isAuthenticated, refresh]);

  // URL?êÏÑú pocketIdÍ∞Ä ?àÏúºÎ©??¥Îãπ ?¨Ïºì ?†ÌÉù
  useEffect(() => {
    if (pocketId && pockets.length > 0) {
      console.log('[Dashboard] ?ìÇ Selecting pocket from URL:', pocketId);
      selectPocket(pocketId);
    }
  }, [pocketId, pockets, selectPocket]);

  // Î∑?Î≥ÄÍ≤????∞Ïù¥??Í∞±Ïã†
  useEffect(() => {
    if (!isAuthenticated) return;

    console.log('[Dashboard] View changed:', currentView);
    
    // ÎπÑÎèôÍ∏??®Ïàò ?∏Ï∂ú ???êÎü¨ ?∏Îì§Îß?    const fetchData = async () => {
      try {
        if (currentView === 'today') {
          await fetchToday();
        } else if (currentView === 'pinned') {
          showPinnedOnly(true);
        } else if (currentView === 'all') {
          showPinnedOnly(false); // ?Ä ?ÑÌÑ∞ ?¥Ï†ú
          await refresh();
        } else if (currentView === 'trash') {
          // TODO: ?¥Ï???Î≥¥Í∏∞ Í∏∞Îä• Íµ¨ÌòÑ ?ÑÏöî (?ÑÏû¨???ºÎ∞ò Î™©Î°ùÍ≥??ôÏùº?òÍ≤å ?ôÏûë?????àÏùå)
          console.warn('Trash view implementation pending');
          // ?ÑÏãúÎ°??ÑÏ≤¥ Î™©Î°ù Î≥¥Ïó¨Ï£ºÍ∏∞
          await refresh();
        }
      } catch (err) {
        console.error('[Dashboard] Error fetching data for view:', currentView, err);
      }
    };

    fetchData();
  }, [currentView, isAuthenticated, fetchToday, refresh, showPinnedOnly]);
  
  // Î°úÍ∑∏?????ÅÌÉú
  const [isLoginMode, setIsLoginMode] = useState(true);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  // Î°úÍ∑∏???åÏõêÍ∞Ä???∏Îì§??  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!email || !password) return;

    setIsSubmitting(true);
    clearError();

    try {
      if (isLoginMode) {
        await signIn(email, password);
      } else {
        await signUp(email, password);
      }
    } finally {
      setIsSubmitting(false);
    }
  };

  // ?∏Ï¶ù Ï≤¥ÌÅ¨ - Î°úÎî© Ï§?  if (authLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="animate-spin w-10 h-10 border-3 border-primary-500 border-t-transparent rounded-full" />
      </div>
    );
  }

  // ÎØ∏Ïù∏Ï¶??ÅÌÉú - Î°úÍ∑∏?????úÏãú
  if (!isAuthenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 via-white to-accent-50">
        <div className="w-full max-w-md p-8">
          {/* Î°úÍ≥† */}
          <div className="text-center mb-8">
            <div className="w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center mb-4">
              <span className="text-white font-bold text-3xl">P</span>
            </div>
            <h1 className="text-2xl font-bold text-gray-900">Pockest</h1>
            <p className="text-gray-500 mt-2">
              {isLoginMode ? t('auth.login_title') : t('auth.signup_title')}
            </p>
          </div>

          {/* Î°úÍ∑∏???åÏõêÍ∞Ä????*/}
          <Card>
            <CardContent className="p-6">
              <form onSubmit={handleSubmit} className="space-y-4">
                <Input
                  type="email"
                  label={t('auth.email_placeholder')}
                  placeholder="your@email.com"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  leftIcon={<Mail className="w-4 h-4" />}
                  required
                />
                
                <Input
                  type="password"
                  label={t('auth.password_placeholder')}
                  placeholder="?¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä?
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  leftIcon={<Lock className="w-4 h-4" />}
                  required
                />

                {error && (
                  <p className="text-sm text-red-600 bg-red-50 p-3 rounded-lg">
                    {error}
                  </p>
                )}

                <Button
                  type="submit"
                  className="w-full"
                  isLoading={isSubmitting}
                >
                  {isLoginMode ? t('auth.login_btn') : t('auth.signup_btn')}
                </Button>
              </form>

              <div className="mt-6 text-center">
                <button
                  type="button"
                  onClick={() => {
                    setIsLoginMode(!isLoginMode);
                    clearError();
                  }}
                  className="text-sm text-primary-600 hover:text-primary-700"
                >
                  {isLoginMode ? t('auth.signup_link') : t('auth.login_link')}
                </button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    );
  }

  // ?∏Ï¶ù???ÅÌÉú - ?Ä?úÎ≥¥???úÏãú
  return (
    <div className="min-h-screen flex flex-col bg-gray-50">
      <Header onSearch={search} />
      
      <div className="flex flex-1 overflow-hidden">
        <Sidebar
          pockets={pockets}
          selectedPocketId={selectedPocketId}
          onSelectPocket={selectPocket}
          onCreatePocket={() => {/* TODO: ?¥Îçî ?ùÏÑ± Î™®Îã¨ */}}
          currentView={currentView}
          onViewChange={setCurrentView}
        />

        {/* Î©îÏù∏ Ïª®ÌÖêÏ∏?*/}
        <main className="flex-1 overflow-y-auto p-6">
          <div className="max-w-6xl mx-auto">
            {/* ?òÏù¥ÏßÄ ?§Îçî */}
            <div className="mb-6 flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-bold text-gray-900">
                  {currentView === 'all' && t('dashboard.all_items')}
                  {currentView === 'today' && t('dashboard.today_saved')}
                  {currentView === 'pinned' && t('dashboard.favorites')}
                  {currentView === 'trash' && t('dashboard.trash')}
                </h1>
                <p className="text-gray-500 mt-1">
                  {t('dashboard.total_items', { count: items?.length || 0 })}
                </p>
              </div>
              {user && (
                <p className="text-sm text-gray-500">{user.email}</p>
              )}
            </div>

            {/* ?ÅÌíà Í∑∏Î¶¨??*/}
            {itemsLoading ? (
              <div className="flex items-center justify-center py-20">
                <div className="animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full" />
              </div>
            ) : !items || items.length === 0 ? (
              <div className="text-center py-20">
                <p className="text-gray-500">{t('dashboard.no_items')}</p>
              </div>
            ) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                {(items || []).map((item) => (
                  <Card key={item.id} className="group overflow-hidden">
                    {/* ?¥Î?ÏßÄ */}
                    <div className="relative aspect-square bg-gray-100">
                      {item.image_url ? (
                        <img
                          src={item.image_url}
                          alt={item.title}
                          className="w-full h-full object-cover"
                        />
                      ) : (
                        <div className="w-full h-full flex items-center justify-center text-gray-300">
                          No Image
                        </div>
                      )}
                      
                      {/* ?§Î≤Ñ?àÏù¥ ?°ÏÖò */}
                      <div className="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-start justify-end p-2 opacity-0 group-hover:opacity-100">
                        <button
                          onClick={() => togglePin(item.id)}
                          className="p-2 bg-white rounded-full shadow-md"
                        >
                          <Star className={cn(
                            'w-4 h-4',
                            item.is_pinned ? 'fill-yellow-400 text-yellow-400' : 'text-gray-400'
                          )} />
                        </button>
                      </div>
                    </div>

                    <CardContent className="p-4">
                      <p className="text-xs text-gray-500 mb-1">{item.site_name}</p>
                      <h3 className="font-medium text-gray-900 text-sm line-clamp-2 mb-2">
                        {item.title}
                      </h3>
                      {item.price && (
                        <p className="font-bold text-primary-600">
                          {formatPrice(item.price, item.currency || 'KRW')}
                        </p>
                      )}
                      <p className="text-xs text-gray-400 mt-2">
                        {formatRelativeTime(item.created_at)}
                      </p>

                      {/* ?°ÏÖò Î≤ÑÌäº */}
                      <div className="flex items-center gap-2 mt-3 pt-3 border-t border-gray-100">
                        <a
                          href={item.url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="flex-1 flex items-center justify-center gap-1 px-3 py-1.5 text-xs text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                        >
                          <ExternalLink className="w-3 h-3" />
                          <span>{t('dashboard.visit')}</span>
                        </a>
                        <button
                          onClick={() => trash(item.id)}
                          className="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            )}
          </div>
        </main>
      </div>
    </div>
  );
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\dashboard\main.tsx
==========================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import { HashRouter, Routes, Route, Navigate } from 'react-router-dom';
import Dashboard from './Dashboard';
import Welcome from '../welcome/Welcome';
import '../../styles/global.css';
import '../../i18n'; // ?§Íµ≠???úÏä§??Ï¥àÍ∏∞??
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <HashRouter>
      <Routes>
        <Route path="/welcome" element={<Welcome />} />
        <Route path="/dashboard/:pocketId?" element={<Dashboard />} />
        <Route path="/" element={<Navigate to="/dashboard" replace />} />
      </Routes>
    </HashRouter>
  </React.StrictMode>
);


==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\popup\main.tsx
==========================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import Popup from './Popup';
import '../../styles/global.css';
import '../../i18n'; // ?§Íµ≠???úÏä§??Ï¥àÍ∏∞??
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Popup />
  </React.StrictMode>
);




==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\popup\Popup.tsx
==========================================
import { useEffect, useState, useCallback, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { 
  ShoppingBag, X, Settings, Search, Edit3, Check, RefreshCw, AlertCircle,
  ChevronLeft, ChevronRight, Undo2, CheckCircle
} from 'lucide-react';
import { useAuth, usePockets, useItems } from '@/hooks';
import { useAuthStore } from '@/store/useAuthStore';
import { usePocketStore } from '@/store/usePocketStore';
import { supabase } from '@/services/supabase/client';
import { Toast, useToast } from '@/components/ui';
import { PocketItem } from '@/components/PocketItem';
import { cn, formatPrice } from '@/utils';
import type { ProductData } from '@/utils/parser';

type ScrapeStatus = 'idle' | 'scraping' | 'saving' | 'success' | 'error';
type TabType = 'pocket' | 'today';

export default function Popup() {
  const { t } = useTranslation();
  const { isAuthenticated, isLoading: authLoading, signIn, signUp, error: authError, clearError } = useAuth();
  const { pockets, selectedPocketId, select: selectPocket, create: createPocket, refresh: refreshPockets } = usePockets();
  const { items, loading: itemsLoading, add: addItem, refresh: refreshItems, fetchToday } = useItems();
  const pocketsLoading = usePocketStore((state) => state.pocketsLoading);
  const { toast, showToast, hideToast } = useToast();

  const [productData, setProductData] = useState<ProductData | null>(null);
  const [status, setStatus] = useState<ScrapeStatus>('idle');
  const [scrapeError, setScrapeError] = useState<string>('');

  // ?¥Î?ÏßÄ ?†ÌÉùÍ∏??ÅÌÉú
  const [selectedImageIndex, setSelectedImageIndex] = useState(0);

  // ?Ä???ÑÎ£å ?ÅÌÉú (UX Í∞úÏÑ†)
  const [isSaved, setIsSaved] = useState(false);
  const [savedPocketName, setSavedPocketName] = useState('');

  // ?ÅÌíàÎ™??∏Ïßë ?ÅÌÉú
  const [isEditingTitle, setIsEditingTitle] = useState(false);
  const [editedTitle, setEditedTitle] = useState('');
  const titleInputRef = useRef<HTMLInputElement>(null);

  // ???ÅÌÉú
  const [activeTab, setActiveTab] = useState<TabType>('pocket');
  const [todayItems, setTodayItems] = useState<typeof items>([]);
  
  // Í≤Ä???ÅÌÉú
  const [searchQuery, setSearchQuery] = useState('');
  
  // ???¥Îçî ?ùÏÑ± ?ÅÌÉú
  const [isCreatingPocket, setIsCreatingPocket] = useState(false);
  const [newPocketName, setNewPocketName] = useState('');
  const [isCreating, setIsCreating] = useState(false);

  // Î°úÍ∑∏?????ÅÌÉú
  const [isLoginMode, setIsLoginMode] = useState(true);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ?ÑÏû¨ ??URL Ï∂îÏ†Å
  const currentUrlRef = useRef<string>('');

  // ============================================================
  // Side Panel ?òÍ≤Ω ?Ä?? Ïª¥Ìè¨?åÌä∏ ÎßàÏö¥????Auth ?∏ÏÖò Î≥µÍµ¨ (1?åÎßå)
  // ============================================================
  useEffect(() => {
    const initAuth = async () => {
      try {
        console.log('[Popup] ?îÑ Initializing auth session...');
        await useAuthStore.getState().initialize();
        console.log('[Popup] ??Auth initialization complete');
      } catch (error) {
        console.error('[Popup] ??Init error:', error);
      }
    };

    initAuth();
  }, []);

  // ============================================================
  // Î°úÍ∑∏???ÅÌÉú Î≥Ä??Í∞êÏ? ???∞Ïù¥???êÎèô Î°úÎìú (?µÏã¨ ?òÏ†ï!)
  // ============================================================
  useEffect(() => {
    if (!isAuthenticated) {
      console.log('[Popup] ?†Ô∏è Not authenticated, skipping data fetch');
      return;
    }

    // Î°úÍ∑∏???ÑÎ£å ???∞Ïù¥???êÎèô Î°úÎìú
    const loadData = async () => {
      try {
        console.log('[Popup] ?îÑ Authenticated! Loading pockets and today items...');
        
        await Promise.all([
          usePocketStore.getState().fetchPockets(),
          usePocketStore.getState().fetchTodayItems()
        ]);
        
        console.log('[Popup] ?éâ Data loaded successfully');
      } catch (error) {
        console.error('[Popup] ??Error loading data:', error);
      }
    };

    loadData();
  }, [isAuthenticated]); // isAuthenticatedÍ∞Ä trueÎ°?Î∞îÎÄåÎ©¥ ?êÎèô ?§Ìñâ

  // ============================================================
  // ?ÑÏû¨ ??óê???ÅÌíà ?ïÎ≥¥ ?§ÌÅ¨?òÌïë
  // ============================================================
  const scrapeCurrentPage = useCallback(async () => {
    if (typeof chrome === 'undefined' || !chrome.tabs) {
      setScrapeError(t('error.not_extension'));
      setStatus('error');
      return;
    }

    setStatus('scraping');
    setScrapeError('');
    setIsSaved(false);
    setSelectedImageIndex(0);
    setIsEditingTitle(false);

    try {
      const [tab] = await chrome.tabs.query({ active: true, lastFocusedWindow: true });
      
      if (!tab?.id || tab.id === chrome.tabs.TAB_ID_NONE) {
        setScrapeError(t('error.no_tab_info'));
        setStatus('error');
        return;
      }

      currentUrlRef.current = tab.url || '';

      if (tab.url?.startsWith('chrome://') || tab.url?.startsWith('edge://') || tab.url?.startsWith('about:')) {
        setScrapeError(t('error.restricted_page'));
        setStatus('error');
        return;
      }

      chrome.tabs.sendMessage(
        tab.id,
        { type: 'SCRAPE_PRODUCT' },
        (response) => {
          if (chrome.runtime.lastError) {
            console.error('[Popup] Message error:', chrome.runtime.lastError.message);
            setScrapeError(t('error.page_communication'));
            setStatus('error');
            return;
          }

          if (response?.success && response.data) {
            setProductData(response.data);
            setEditedTitle(response.data.title); // ?∏Ïßë???úÎ™© Ï¥àÍ∏∞??            setScrapeError('');
            setStatus('idle');
          } else {
            setScrapeError(response?.error || t('error.product_not_found'));
            setStatus('error');
          }
        }
      );
    } catch (error) {
      console.error('[Popup] Scrape error:', error);
      setScrapeError(t('common.error'));
      setStatus('error');
    }
  }, [t]);

  // ============================================================
  // Chrome Tab Event Listeners (?¨Ïù¥???®ÎÑê ?ôÍ∏∞??
  // ============================================================
  useEffect(() => {
    if (!isAuthenticated || typeof chrome === 'undefined') return;

    scrapeCurrentPage();

    const handleTabActivated = (activeInfo: chrome.tabs.TabActiveInfo) => {
      console.log('[Popup] Tab activated:', activeInfo.tabId);
      setTimeout(() => {
        scrapeCurrentPage();
      }, 100);
    };

    const handleTabUpdated = (
      _tabId: number,
      changeInfo: chrome.tabs.TabChangeInfo,
      tab: chrome.tabs.Tab
    ) => {
      if (changeInfo.status === 'complete' && tab.active) {
        if (tab.url && tab.url !== currentUrlRef.current) {
          console.log('[Popup] Tab URL changed:', tab.url);
          currentUrlRef.current = tab.url;
          scrapeCurrentPage();
        }
      }
    };

    chrome.tabs.onActivated.addListener(handleTabActivated);
    chrome.tabs.onUpdated.addListener(handleTabUpdated);

    return () => {
      chrome.tabs.onActivated.removeListener(handleTabActivated);
      chrome.tabs.onUpdated.removeListener(handleTabUpdated);
    };
  }, [isAuthenticated, scrapeCurrentPage]);

  // ============================================================
  // Today ??- DB??24?úÍ∞Ñ Î°úÏßÅ???†Î¢∞ (?ÑÎ°†?∏Ïóî???ÑÌÑ∞Îß??úÍ±∞)
  // ============================================================
  useEffect(() => {
    if (activeTab === 'today' && isAuthenticated) {
      // DB RPC(get_today_items)Î°?24?úÍ∞Ñ ?¥ÎÇ¥ ?∞Ïù¥??Ï°∞Ìöå
      fetchToday().then(() => {
        // fetchTodayÍ∞Ä items ?ÅÌÉúÎ•??ÖÎç∞?¥Ìä∏?òÎ?Î°?Î≥ÑÎèÑ ?ÑÌÑ∞Îß?Î∂àÌïÑ??        console.log('[Popup] Today items fetched from DB (24h logic)');
      }).catch((err) => {
        console.error('[Popup] Failed to fetch today items:', err);
      });
    }
  }, [activeTab, isAuthenticated, fetchToday]);

  // Today ??ö© ?ÑÏù¥??(items ?ÅÌÉúÎ•?Í∑∏Î?Î°??¨Ïö©)
  useEffect(() => {
    if (activeTab === 'today') {
      setTodayItems(items);
    }
  }, [activeTab, items]);

  // ?¥Îçî Í≤Ä???ÑÌÑ∞Îß?  const filteredPockets = pockets.filter((pocket) =>
    pocket.name.toLowerCase().includes(searchQuery.toLowerCase())
  );

  // ============================================================
  // ?¥Î?ÏßÄ ?§ÎπÑÍ≤åÏù¥??(Carousel)
  // ============================================================
  const imageUrls = productData?.imageUrls || [];
  const currentImageUrl = imageUrls[selectedImageIndex] || productData?.imageUrl || '';
  const hasMultipleImages = imageUrls.length > 1;

  const handlePrevImage = (e: React.MouseEvent) => {
    e.stopPropagation();
    if (selectedImageIndex > 0) {
      setSelectedImageIndex(selectedImageIndex - 1);
    }
  };

  const handleNextImage = (e: React.MouseEvent) => {
    e.stopPropagation();
    if (selectedImageIndex < imageUrls.length - 1) {
      setSelectedImageIndex(selectedImageIndex + 1);
    }
  };

  // ============================================================
  // ?ÅÌíàÎ™??∏Ïßë ?∏Îì§??  // ============================================================
  const handleStartEditTitle = () => {
    if (productData) {
      setEditedTitle(productData.title);
      setIsEditingTitle(true);
      setTimeout(() => titleInputRef.current?.focus(), 50);
    }
  };

  const handleSaveTitle = () => {
    if (productData && editedTitle.trim()) {
      setProductData({
        ...productData,
        title: editedTitle.trim(),
      });
    }
    setIsEditingTitle(false);
  };

  const handleTitleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleSaveTitle();
    } else if (e.key === 'Escape') {
      setIsEditingTitle(false);
      if (productData) setEditedTitle(productData.title);
    }
  };

  // ============================================================
  // Î°úÍ∑∏???åÏõêÍ∞Ä???∏Îì§??  // ============================================================
  const handleAuthSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!email || !password) return;

    setIsSubmitting(true);
    clearError();

    try {
      if (isLoginMode) {
        await signIn(email, password);
      } else {
        await signUp(email, password);
      }
    } finally {
      setIsSubmitting(false);
    }
  };

  // ============================================================
  // ?¥Îçî???Ä???∏Îì§??  // ============================================================
  const handleSaveToPocket = async (pocketId: string) => {
    if (!productData) {
      showToast(t('toast.fetch_product_first'), 'warning');
      return;
    }

    const pocket = pockets.find((p) => p.id === pocketId);
    setStatus('saving');

    try {
      const result = await addItem({
        url: productData.url,
        title: productData.title, // ?∏Ïßë???úÎ™© ?¨Ïö©
        site_name: productData.mallName || null,
        image_url: currentImageUrl || null,
        price: productData.price,
        currency: productData.currency || 'KRW',
        pocket_id: pocketId,
        is_pinned: false,
        memo: null,
        deleted_at: null,
      });

      if (result) {
        setStatus('success');
        setIsSaved(true);
        setSavedPocketName(pocket?.name || 'Pocket');
        showToast(t('toast.item_saved'), 'success');
        refreshItems();
      } else {
        throw new Error('Save failed');
      }
    } catch (error) {
      console.error('[Popup] Save error:', error);
      setStatus('error');
      showToast(t('toast.save_failed'), 'error');
    }
  };

  // ?Ä??Ï∑®ÏÜå (?òÎèåÎ¶¨Í∏∞)
  const handleUndoSave = () => {
    setIsSaved(false);
    setSavedPocketName('');
    setStatus('idle');
  };

  // ============================================================
  // ???¥Îçî ?ùÏÑ± ?∏Îì§??  // ============================================================
  const handleCreatePocket = async (e?: React.MouseEvent) => {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }

    if (!newPocketName.trim()) return;
    if (isCreating) return;

    setIsCreating(true);

    try {
      const authState = useAuthStore.getState();
      
      if (!authState.user) {
        await authState.initialize();
        
        const refreshedState = useAuthStore.getState();
        if (!refreshedState.user) {
          showToast(t('toast.login_required'), 'warning');
          setIsCreating(false);
          return;
        }
      }

      const result = await createPocket(newPocketName.trim());
      
      if (result) {
        setNewPocketName('');
        setIsCreatingPocket(false);
        showToast(t('toast.pocket_created'), 'success');
        refreshPockets();
      }
    } catch (error) {
      console.error('[Popup] Create pocket error:', error);
      const errorMessage = error instanceof Error ? error.message : t('common.error');
      showToast(errorMessage, 'error');
    } finally {
      setIsCreating(false);
    }
  };

  // ?ÑÏù¥????†ú (Today ??óê??
  const handleRemoveItem = async (itemId: string) => {
    setTodayItems((prev) => prev.filter((item) => item.id !== itemId));
  };

  // ?ùÏóÖ ?´Í∏∞
  const handleClose = () => {
    window.close();
  };

  // ?§Ï†ï ?¥Í∏∞
  const handleOpenSettings = () => {
    if (typeof chrome !== 'undefined' && chrome.tabs) {
      chrome.tabs.create({ url: chrome.runtime.getURL('index.html#/dashboard') });
    }
  };

  // ============================================================
  // Î°úÎî© ?ÅÌÉú
  // ============================================================
  if (authLoading) {
    return (
      <div className="h-screen flex items-center justify-center bg-white">
        <div className="animate-spin w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full" />
      </div>
    );
  }

  // ============================================================
  // Î°úÍ∑∏???îÎ©¥
  // ============================================================
  if (!isAuthenticated) {
    return (
      <div className="h-screen flex flex-col bg-white overflow-hidden">
        <header className="flex-none flex items-center justify-between px-4 py-3 border-b border-gray-100">
          <div className="flex items-center gap-2">
            <div className="w-7 h-7 rounded-lg bg-violet-500 flex items-center justify-center">
              <ShoppingBag className="w-4 h-4 text-white" />
            </div>
            <span className="text-lg font-bold text-violet-500">pockest</span>
          </div>
          <button onClick={handleClose} className="p-1 hover:bg-gray-100 rounded-lg">
            <X className="w-5 h-5 text-gray-400" />
          </button>
        </header>

        <div className="flex-1 flex flex-col items-center justify-center p-6">
          <div className="w-16 h-16 rounded-2xl bg-violet-100 flex items-center justify-center mb-4">
            <ShoppingBag className="w-8 h-8 text-violet-500" />
          </div>
          <h1 className="text-xl font-bold text-gray-900 mb-1">Pockest</h1>
          <p className="text-gray-500 text-sm mb-6 text-center">
            {isLoginMode ? t('auth.login_title') : t('auth.signup_title')}
          </p>

          <form onSubmit={handleAuthSubmit} className="w-full space-y-3">
            <input
              type="email"
              placeholder={t('auth.email_placeholder')}
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-violet-400 focus:ring-2 focus:ring-violet-100"
              required
            />
            
            <input
              type="password"
              placeholder={t('auth.password_placeholder')}
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:border-violet-400 focus:ring-2 focus:ring-violet-100"
              required
            />

            {authError && (
              <p className="text-xs text-red-600 bg-red-50 p-3 rounded-xl">
                {authError}
              </p>
            )}

            <button
              type="submit"
              disabled={isSubmitting}
              className="w-full h-12 bg-violet-500 hover:bg-violet-600 text-white font-semibold rounded-xl transition-colors disabled:opacity-50"
            >
              {isSubmitting ? t('auth.processing') : (isLoginMode ? t('auth.login_btn') : t('auth.signup_btn'))}
            </button>
          </form>

          <button
            type="button"
            onClick={() => {
              setIsLoginMode(!isLoginMode);
              clearError();
            }}
            className="mt-4 text-sm text-violet-500 hover:text-violet-600 font-medium"
          >
            {isLoginMode ? t('auth.signup_link') : t('auth.login_link')}
          </button>
        </div>
      </div>
    );
  }

  // ============================================================
  // Î©îÏù∏ ?îÎ©¥ (?∏Ï¶ù?? - Full Height ?àÏù¥?ÑÏõÉ
  // ============================================================
  return (
    <div className="h-screen flex flex-col bg-white overflow-hidden">
      {/* ?§Îçî - flex-none (Í≥†Ï†ï ?íÏù¥) */}
      <header className="flex-none flex items-center justify-between px-4 py-2 border-b border-gray-100">
        <div className="flex items-center gap-2">
          <div className="w-6 h-6 rounded-lg bg-violet-500 flex items-center justify-center">
            <ShoppingBag className="w-3.5 h-3.5 text-white" />
          </div>
          <span className="text-base font-bold text-violet-500">pockest</span>
        </div>
        <div className="flex items-center gap-0.5">
          <button 
            onClick={handleOpenSettings}
            className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <Settings className="w-4 h-4 text-gray-400" />
          </button>
          <button 
            onClick={handleClose}
            className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <X className="w-4 h-4 text-gray-400" />
          </button>
        </div>
      </header>

      {/* ?ÅÌíà ?ïÎ≥¥ ?ÑÎ¶¨Î∑??ÅÏó≠ - flex-none (Í≥†Ï†ï ?íÏù¥) */}
      {isSaved ? (
        <div className="flex-none px-4 py-4 bg-green-50 border-b border-green-100">
          <div className="flex items-center gap-3">
            <CheckCircle className="w-8 h-8 text-green-500 flex-shrink-0" />
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-green-700">
                "{savedPocketName}"{t('popup.saved_to')}
              </p>
              <p className="text-xs text-green-600">{t('popup.see_other_products')}</p>
            </div>
            <button
              onClick={handleUndoSave}
              className="flex items-center gap-1 px-2.5 py-1.5 bg-white text-green-600 text-xs font-medium rounded-lg border border-green-200 hover:bg-green-50 transition-colors flex-shrink-0"
            >
              <Undo2 className="w-3 h-3" />
              {t('popup.undo')}
            </button>
          </div>
        </div>
      ) : status === 'scraping' ? (
        <div className="flex-none px-4 py-4 bg-gray-50 border-b border-gray-100">
          <div className="flex items-center justify-center gap-2">
            <div className="animate-spin w-4 h-4 border-2 border-violet-500 border-t-transparent rounded-full" />
            <span className="text-sm text-gray-500">{t('popup.fetching_product')}</span>
          </div>
        </div>
      ) : status === 'error' || (!productData && status === 'idle') ? (
        <div className="flex-none px-4 py-4 bg-gray-50 border-b border-gray-100">
          <div className="flex items-center gap-3">
            <AlertCircle className="w-8 h-8 text-gray-300 flex-shrink-0" />
            <div className="flex-1 min-w-0">
              <p className="text-sm text-gray-500">
                {scrapeError || t('popup.fetch_failed')}
              </p>
            </div>
            <button
              onClick={scrapeCurrentPage}
              className="flex items-center gap-1.5 px-3 py-1.5 bg-violet-100 text-violet-600 text-xs font-medium rounded-lg hover:bg-violet-200 transition-colors flex-shrink-0"
            >
              <RefreshCw className="w-3 h-3" />
              {t('popup.retry')}
            </button>
          </div>
        </div>
      ) : productData ? (
        <div className="flex-none px-4 py-3 bg-gray-50 border-b border-gray-100">
          <div className="flex items-start gap-3">
            {/* ?¥Î?ÏßÄ ?†ÌÉùÍ∏?(Carousel) */}
            <div className="relative w-24 h-24 rounded-xl overflow-hidden bg-gray-200 flex-shrink-0">
              {currentImageUrl ? (
                <img src={currentImageUrl} alt="" className="w-full h-full object-cover" />
              ) : (
                <div className="w-full h-full flex items-center justify-center">
                  <ShoppingBag className="w-8 h-8 text-gray-400" />
                </div>
              )}
              
              {hasMultipleImages && (
                <>
                  <button
                    onClick={handlePrevImage}
                    disabled={selectedImageIndex === 0}
                    className={cn(
                      'absolute left-0 top-1/2 -translate-y-1/2 w-6 h-6 bg-black/50 text-white flex items-center justify-center rounded-r transition-opacity',
                      selectedImageIndex === 0 ? 'opacity-30' : 'hover:bg-black/70'
                    )}
                  >
                    <ChevronLeft className="w-4 h-4" />
                  </button>
                  <button
                    onClick={handleNextImage}
                    disabled={selectedImageIndex === imageUrls.length - 1}
                    className={cn(
                      'absolute right-0 top-1/2 -translate-y-1/2 w-6 h-6 bg-black/50 text-white flex items-center justify-center rounded-l transition-opacity',
                      selectedImageIndex === imageUrls.length - 1 ? 'opacity-30' : 'hover:bg-black/70'
                    )}
                  >
                    <ChevronRight className="w-4 h-4" />
                  </button>
                  <div className="absolute bottom-1 left-1/2 -translate-x-1/2 bg-black/50 text-white text-[10px] px-1.5 py-0.5 rounded">
                    {selectedImageIndex + 1}/{imageUrls.length}
                  </div>
                </>
              )}
            </div>

            {/* ?ÅÌíà ?ïÎ≥¥ + ?úÎ™© ?∏Ïßë */}
            <div className="flex-1 min-w-0">
              <p className="text-[10px] text-violet-500 font-medium mb-0.5">{productData.mallName}</p>
              
              {/* ?úÎ™© ?∏Ïßë ?ÅÏó≠ */}
              {isEditingTitle ? (
                <input
                  ref={titleInputRef}
                  type="text"
                  value={editedTitle}
                  onChange={(e) => setEditedTitle(e.target.value)}
                  onBlur={handleSaveTitle}
                  onKeyDown={handleTitleKeyDown}
                  className="w-full text-sm font-medium text-gray-900 border border-violet-300 rounded-lg px-2 py-1 focus:outline-none focus:ring-1 focus:ring-violet-400"
                />
              ) : (
                <div className="flex items-start gap-2">
                  <p className="text-sm font-medium text-gray-900 line-clamp-2 flex-1">{productData.title}</p>
                  <button
                    onClick={handleStartEditTitle}
                    className="px-2 py-0.5 text-[10px] font-medium text-violet-500 bg-violet-50 hover:bg-violet-100 rounded-full transition-colors flex-shrink-0"
                  >
                    {t('popup.edit')}
                  </button>
                </div>
              )}
              
              {productData.price && (
                <p className="text-sm font-bold text-gray-900 mt-0.5">
                  {formatPrice(productData.price, productData.currency)}
                </p>
              )}
            </div>
          </div>
          
          {/* ?¥Î?ÏßÄ ?∏ÎÑ§??Î¶¨Ïä§??*/}
          {hasMultipleImages && (
            <div className="flex gap-1.5 mt-2 overflow-x-auto pb-1">
              {imageUrls.slice(0, 5).map((img, idx) => (
                <button
                  key={idx}
                  onClick={() => setSelectedImageIndex(idx)}
                  className={cn(
                    'w-10 h-10 rounded-lg overflow-hidden flex-shrink-0 border-2 transition-all',
                    idx === selectedImageIndex
                      ? 'border-violet-500'
                      : 'border-transparent hover:border-gray-300'
                  )}
                >
                  <img src={img} alt="" className="w-full h-full object-cover" />
                </button>
              ))}
            </div>
          )}
        </div>
      ) : null}

      {/* Body - flex-1 (?®Ï? Í≥µÍ∞Ñ ?ÑÎ? Ï∞®Ï?) */}
      <div className="flex-1 flex flex-col overflow-hidden">
        {/* ?Ä?¥Ì? + Í≤Ä?âÎ∞î - flex-none */}
        <div className="flex-none px-4 pt-3 pb-2">
          <h2 className="text-center text-gray-800 font-medium text-xs mb-2">
            {t('popup.select_pocket')}
          </h2>
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gray-400" />
            <input
              type="text"
              placeholder={t('popup.search_pocket')}
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-8 pr-3 py-2 bg-gray-50 border border-gray-100 rounded-lg text-sm focus:outline-none focus:border-violet-300 focus:bg-white transition-colors"
            />
          </div>
        </div>

        {/* ??Î©îÎâ¥ - flex-none */}
        <div className="flex-none flex border-b border-gray-100">
          <button
            onClick={() => setActiveTab('pocket')}
            className={cn(
              'flex-1 py-2 text-xs font-medium text-center transition-colors relative',
              activeTab === 'pocket'
                ? 'text-violet-600'
                : 'text-gray-400 hover:text-gray-600'
            )}
          >
            {t('popup.tab_pocket')}
            {activeTab === 'pocket' && (
              <div className="absolute bottom-0 left-4 right-4 h-0.5 bg-violet-500 rounded-full" />
            )}
          </button>
          <button
            onClick={() => setActiveTab('today')}
            className={cn(
              'flex-1 py-2 text-xs font-medium text-center transition-colors relative',
              activeTab === 'today'
                ? 'text-violet-600'
                : 'text-gray-400 hover:text-gray-600'
            )}
          >
            {t('popup.tab_today')}
            {activeTab === 'today' && (
              <div className="absolute bottom-0 left-4 right-4 h-0.5 bg-violet-500 rounded-full" />
            )}
          </button>
        </div>

        {/* Î¶¨Ïä§???ÅÏó≠ - flex-1 overflow-y-auto + pb-20 (?òÎã® Î≤ÑÌäº Í≥µÍ∞Ñ ?ïÎ≥¥) */}
        <div className="flex-1 overflow-y-auto pb-20">
          {/* Î°úÎî© ?§Ìîº?? ?∞Ïù¥??Î°úÎìú Ï§ëÏùº ???úÏãú */}
          {(activeTab === 'pocket' && pocketsLoading) || (activeTab === 'today' && itemsLoading) ? (
            <div className="flex flex-col items-center justify-center py-12 gap-3">
              <div className="animate-spin w-8 h-8 border-3 border-violet-500 border-t-transparent rounded-full" />
              <p className="text-sm text-gray-500">{t('popup.loading_data')}</p>
            </div>
          ) : activeTab === 'pocket' ? (
            <div className="divide-y divide-gray-50">
              {filteredPockets.length === 0 ? (
                <div className="text-center py-8 text-gray-400 text-sm">
                  {searchQuery ? t('popup.no_search_results') : t('popup.no_folders')}
                </div>
              ) : (
                filteredPockets.map((pocket) => (
                  <PocketItem
                    key={pocket.id}
                    pocket={pocket}
                    onSave={handleSaveToPocket}
                    isSelected={selectedPocketId === pocket.id}
                    isSaving={status === 'saving'}
                    showSaveButton={productData !== null && !isSaved}
                    onClick={(pocketId) => {
                      selectPocket(pocketId);
                      if (productData && !isSaved) {
                        handleSaveToPocket(pocketId);
                      }
                    }}
                  />
                ))
              )}
            </div>
          ) : (
            <div className="divide-y divide-gray-50">
              {todayItems.length === 0 ? (
                <div className="text-center py-8 text-gray-400 text-sm">
                  {t('popup.no_today_items')}
                </div>
              ) : (
                todayItems.map((item) => {
                  // ?Ä???úÍ∞Ñ??Î°úÏª¨ ?Ä?ÑÏ°¥?ºÎ°ú Î≥Ä??                  const savedTime = new Date(item.created_at).toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit',
                  });
                  
                  return (
                    <div
                      key={item.id}
                      className="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 cursor-pointer transition-colors"
                      onClick={() => window.open(item.url, '_blank')}
                    >
                      <div className="w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                        {item.image_url ? (
                          <img src={item.image_url} alt={item.title} className="w-full h-full object-cover" />
                        ) : (
                          <div className="w-full h-full flex items-center justify-center">
                            <ShoppingBag className="w-5 h-5 text-gray-300" />
                          </div>
                        )}
                      </div>

                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-1.5">
                          <p className="text-[10px] text-gray-400">{item.site_name}</p>
                          <span className="text-[10px] text-gray-300">??/span>
                          <p className="text-[10px] text-violet-400">{savedTime}</p>
                        </div>
                        <p className="font-medium text-sm text-gray-900 truncate">{item.title}</p>
                        {item.price && (
                          <p className="text-xs font-bold text-gray-900">
                            {formatPrice(item.price, item.currency || 'KRW')}
                          </p>
                        )}
                      </div>

                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          handleRemoveItem(item.id);
                        }}
                        className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <X className="w-3.5 h-3.5 text-gray-400" />
                      </button>
                    </div>
                  );
                })
              )}
            </div>
          )}
        </div>
      </div>

      {/* Footer - fixed bottom (?òÎã® Í≥†Ï†ï) */}
      <div className="fixed bottom-0 left-0 right-0 p-3 bg-white/95 backdrop-blur border-t border-gray-100">
        {isCreatingPocket ? (
          <div className="flex items-center gap-2">
            <input
              type="text"
              placeholder={t('popup.new_pocket_name')}
              value={newPocketName}
              onChange={(e) => setNewPocketName(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  handleCreatePocket();
                }
              }}
              className="flex-1 px-3 py-2.5 border border-violet-200 rounded-xl text-sm focus:outline-none focus:border-violet-400"
              autoFocus
            />
            <button
              type="button"
              onClick={(e) => handleCreatePocket(e)}
              disabled={!newPocketName.trim() || isCreating}
              className="p-2.5 bg-violet-500 text-white rounded-xl hover:bg-violet-600 disabled:opacity-50 transition-colors"
            >
              {isCreating ? (
                <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" />
              ) : (
                <Check className="w-4 h-4" />
              )}
            </button>
            <button
              type="button"
              onClick={() => {
                setIsCreatingPocket(false);
                setNewPocketName('');
              }}
              className="p-2.5 bg-gray-100 text-gray-500 rounded-xl hover:bg-gray-200 transition-colors"
            >
              <X className="w-4 h-4" />
            </button>
          </div>
        ) : (
          <button
            type="button"
            onClick={() => setIsCreatingPocket(true)}
            className="w-full h-11 bg-violet-500 hover:bg-violet-600 text-white font-semibold rounded-xl flex items-center justify-center gap-2 transition-colors shadow-lg shadow-violet-200"
          >
            <span className="text-sm">{t('popup.create_pocket')}</span>
            <Edit3 className="w-3.5 h-3.5" />
          </button>
        )}
      </div>

      {/* Toast ?åÎ¶º */}
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={hideToast}
        />
      )}
    </div>
  );
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\pages\welcome\Welcome.tsx
==========================================
import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { ShoppingBag, Pin, PanelRight, ArrowRight, Sparkles, Globe } from 'lucide-react';
import { supportedLanguages, languageNames, changeLanguage, getCurrentLanguage, type SupportedLanguage } from '../../i18n';

export default function Welcome() {
  const navigate = useNavigate();
  const { t } = useTranslation();
  const currentLang = getCurrentLanguage();

  const handleGetStarted = () => {
    // ?Ä?úÎ≥¥?úÎ°ú ?¥Îèô (Î°úÍ∑∏???ÑÏöî ???êÎèô?ºÎ°ú Î°úÍ∑∏???îÎ©¥ ?úÏãú)
    navigate('/dashboard');
  };

  const handleLanguageChange = (lng: SupportedLanguage) => {
    changeLanguage(lng);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-violet-50 via-white to-purple-50 flex items-center justify-center p-6 relative">
      {/* ?∏Ïñ¥ ?†ÌÉùÍ∏?*/}
      <div className="absolute top-4 right-4 flex items-center gap-2">
        <Globe className="w-4 h-4 text-gray-400" />
        <select
          value={currentLang}
          onChange={(e) => handleLanguageChange(e.target.value as SupportedLanguage)}
          className="bg-white border border-gray-200 rounded-lg px-3 py-1.5 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400 cursor-pointer"
        >
          {supportedLanguages.map((lng) => (
            <option key={lng} value={lng}>
              {languageNames[lng]}
            </option>
          ))}
        </select>
      </div>

      <div className="max-w-4xl w-full">
        {/* ?§Îçî */}
        <div className="text-center mb-12">
          <div className="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 mb-6 shadow-lg shadow-violet-200">
            <ShoppingBag className="w-10 h-10 text-white" />
          </div>
          <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-4 flex items-center justify-center gap-3 flex-wrap">
            {t('welcome.title')}
            <Sparkles className="w-8 h-8 text-violet-500" />
          </h1>
          <p className="text-lg text-gray-600">
            {t('welcome.subtitle')}
          </p>
        </div>

        {/* Í∞Ä?¥Îìú Ïπ¥Îìú (3?®Í≥Ñ) */}
        <div className="grid md:grid-cols-3 gap-6 mb-12">
          {/* Step 1 */}
          <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div className="w-12 h-12 rounded-xl bg-violet-100 flex items-center justify-center mb-4">
              <Pin className="w-6 h-6 text-violet-600" />
            </div>
            <div className="flex items-center gap-2 mb-3">
              <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-violet-500 text-white text-xs font-bold">
                1
              </span>
              <h3 className="text-lg font-semibold text-gray-900">{t('welcome.step1_title')}</h3>
            </div>
            <p className="text-gray-600 text-sm leading-relaxed">
              {t('welcome.step1_desc')}
            </p>
          </div>

          {/* Step 2 */}
          <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div className="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center mb-4">
              <PanelRight className="w-6 h-6 text-purple-600" />
            </div>
            <div className="flex items-center gap-2 mb-3">
              <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-purple-500 text-white text-xs font-bold">
                2
              </span>
              <h3 className="text-lg font-semibold text-gray-900">{t('welcome.step2_title')}</h3>
            </div>
            <p className="text-gray-600 text-sm leading-relaxed">
              {t('welcome.step2_desc')}
            </p>
          </div>

          {/* Step 3 */}
          <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <div className="w-12 h-12 rounded-xl bg-indigo-100 flex items-center justify-center mb-4">
              <ShoppingBag className="w-6 h-6 text-indigo-600" />
            </div>
            <div className="flex items-center gap-2 mb-3">
              <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-indigo-500 text-white text-xs font-bold">
                3
              </span>
              <h3 className="text-lg font-semibold text-gray-900">{t('welcome.step3_title')}</h3>
            </div>
            <p className="text-gray-600 text-sm leading-relaxed">
              {t('welcome.step3_desc')}
            </p>
          </div>
        </div>

        {/* Ï∂îÍ? ?ïÎ≥¥ */}
        <div className="bg-gradient-to-r from-violet-500 to-purple-600 rounded-2xl p-8 text-center text-white mb-8 shadow-lg">
          <h3 className="text-xl font-semibold mb-3">{t('welcome.tips_title')}</h3>
          <div className="space-y-2 text-violet-50">
            <p>{t('welcome.tip1')}</p>
            <p>{t('welcome.tip2')}</p>
            <p>{t('welcome.tip3')}</p>
          </div>
        </div>

        {/* ?úÏûë?òÍ∏∞ Î≤ÑÌäº */}
        <div className="text-center">
          <button
            onClick={handleGetStarted}
            className="inline-flex items-center gap-3 px-8 py-4 bg-violet-600 hover:bg-violet-700 text-white font-semibold text-lg rounded-xl shadow-lg shadow-violet-200 hover:shadow-xl hover:shadow-violet-300 transition-all transform hover:scale-105"
          >
            {t('welcome.start_btn')}
            <ArrowRight className="w-5 h-5" />
          </button>
          <p className="mt-4 text-sm text-gray-500">
            {t('welcome.start_hint')}
          </p>
        </div>
      </div>
    </div>
  );
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\services\storage\chromeStorage.ts
==========================================
/**
 * Chrome Storage API ?òÌçº
 * ExtensionÍ≥?Web ?òÍ≤Ω Î™®Îëê?êÏÑú ?ôÏûë?òÎèÑÎ°?Ï∂îÏÉÅ??
 */

type StorageArea = 'local' | 'sync' | 'session';

interface StorageWrapper {
  get: <T>(key: string) => Promise<T | null>;
  set: <T>(key: string, value: T) => Promise<void>;
  remove: (key: string) => Promise<void>;
  clear: () => Promise<void>;
}

const isChromeExtension = (): boolean => {
  return typeof chrome !== 'undefined' && !!chrome.storage;
};

/**
 * Chrome Storage API ?òÌçº ?ùÏÑ±
 */
export const createStorage = (area: StorageArea = 'local'): StorageWrapper => {
  if (isChromeExtension()) {
    const storage = chrome.storage[area];

    return {
      get: async <T>(key: string): Promise<T | null> => {
        const result = await storage.get(key);
        return (result[key] as T) ?? null;
      },

      set: async <T>(key: string, value: T): Promise<void> => {
        await storage.set({ [key]: value });
      },

      remove: async (key: string): Promise<void> => {
        await storage.remove(key);
      },

      clear: async (): Promise<void> => {
        await storage.clear();
      },
    };
  }

  // ???òÍ≤Ω?êÏÑú??localStorage ?¨Ïö©
  return {
    get: async <T>(key: string): Promise<T | null> => {
      const item = localStorage.getItem(key);
      if (!item) return null;
      try {
        return JSON.parse(item) as T;
      } catch {
        return item as T;
      }
    },

    set: async <T>(key: string, value: T): Promise<void> => {
      localStorage.setItem(key, JSON.stringify(value));
    },

    remove: async (key: string): Promise<void> => {
      localStorage.removeItem(key);
    },

    clear: async (): Promise<void> => {
      localStorage.clear();
    },
  };
};

// Í∏∞Î≥∏ ?§ÌÜ†Î¶¨Ï? ?∏Ïä§?¥Ïä§
export const storage = createStorage('local');
export const syncStorage = createStorage('sync');

// ?êÏ£º ?¨Ïö©?òÎäî ???ÅÏàò
export const STORAGE_KEYS = {
  AUTH_SESSION: 'pockest_auth_session',
  USER_PREFERENCES: 'pockest_user_preferences',
  LAST_SYNC: 'pockest_last_sync',
  CACHED_ITEMS: 'pockest_cached_items',
} as const;






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\services\supabase\client.ts
==========================================
/// <reference types="vite/client" />

import { createClient } from '@supabase/supabase-js';
import type { Database } from '@/types/database';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL as string;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY as string;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

/**
 * Supabase Client ?§Ï†ï
 * Chrome Extension ?òÍ≤Ω?êÏÑú??detectSessionInUrl??ÎπÑÌôú?±Ìôî?¥Ïïº ?? */
export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: false,
    storage: typeof window !== 'undefined' ? window.localStorage : undefined,
    flowType: 'pkce',
  },
});

// ?∏Ï¶ù ?ÅÌÉú Î≥ÄÍ≤?Î¶¨Ïä§??export const onAuthStateChange = (
  callback: (event: string, session: unknown) => void
) => {
  return supabase.auth.onAuthStateChange(callback);
};

// ?ÑÏû¨ ?∏ÏÖò Í∞Ä?∏Ïò§Í∏?export const getSession = async () => {
  try {
    const { data, error } = await supabase.auth.getSession();
    if (error) {
      console.error('[Supabase] getSession error:', error.message);
      return null;
    }
    return data.session;
  } catch (error) {
    console.error('[Supabase] getSession exception:', error);
    return null;
  }
};

// ?ÑÏû¨ ?†Ï? Í∞Ä?∏Ïò§Í∏?export const getUser = async () => {
  try {
    const { data, error } = await supabase.auth.getUser();
    if (error) {
      console.error('[Supabase] getUser error:', error.message);
      return null;
    }
    return data.user;
  } catch (error) {
    console.error('[Supabase] getUser exception:', error);
    return null;
  }
};

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\store\useAuthStore.ts
==========================================
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { supabase } from '@/services/supabase/client';
import type { User, AuthStatus } from '@/types';
import type { Profile } from '@/types/database';

interface AuthState {
  user: User | null;
  status: AuthStatus;
  error: string | null;

  // Actions
  initialize: () => Promise<void>;
  signInWithEmail: (email: string, password: string) => Promise<void>;
  signUpWithEmail: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
  clearError: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      status: 'loading',
      error: null,

      initialize: async () => {
        try {
          const { data: { session }, error: sessionError } = await supabase.auth.getSession();
          
          if (sessionError) {
            console.error('[Auth] Session error:', sessionError.message);
            set({ user: null, status: 'unauthenticated', error: null });
            return;
          }
          
          if (session?.user) {
            // profiles ?åÏù¥Î∏îÏóê??Ï∂îÍ? ?ïÎ≥¥ Í∞Ä?∏Ïò§Í∏?            const { data: profile, error: profileError } = await supabase
              .from('profiles')
              .select('tier')
              .eq('id', session.user.id)
              .single();

            if (profileError) {
              console.warn('[Auth] Profile fetch warning:', profileError.message);
            }

            const profileData = profile as Pick<Profile, 'tier'> | null;

            set({
              user: {
                id: session.user.id,
                email: session.user.email || '',
                tier: profileData?.tier || 'free',
              },
              status: 'authenticated',
              error: null,
            });
            return;
          }
          
          set({ user: null, status: 'unauthenticated', error: null });
        } catch (error) {
          const errorMessage = error instanceof Error ? error.message : 'Unknown error';
          console.error('[Auth] Initialize exception:', errorMessage);
          set({ user: null, status: 'unauthenticated', error: null });
        }
      },

      signInWithEmail: async (email, password) => {
        set({ status: 'loading', error: null });
        
        try {
          const { data, error } = await supabase.auth.signInWithPassword({
            email,
            password,
          });

          if (error) {
            console.error('[Auth] SignIn error:', error.message);
            set({
              user: null,
              status: 'unauthenticated',
              error: error.message === 'Invalid login credentials' 
                ? '?¥Î©î???êÎäî ÎπÑÎ?Î≤àÌò∏Í∞Ä ?¨Î∞îÎ•¥Ï? ?äÏäµ?àÎã§.' 
                : error.message,
            });
            return;
          }

          if (data.user) {
            const { data: profile } = await supabase
              .from('profiles')
              .select('tier')
              .eq('id', data.user.id)
              .single();

            const profileData = profile as Pick<Profile, 'tier'> | null;

            set({
              user: {
                id: data.user.id,
                email: data.user.email || '',
                tier: profileData?.tier || 'free',
              },
              status: 'authenticated',
              error: null,
            });
          }
        } catch (error) {
          const errorMessage = error instanceof Error ? error.message : 'Î°úÍ∑∏?∏Ïóê ?§Ìå®?àÏäµ?àÎã§.';
          console.error('[Auth] SignIn exception:', errorMessage);
          set({
            user: null,
            status: 'unauthenticated',
            error: errorMessage,
          });
        }
      },

      signUpWithEmail: async (email, password) => {
        set({ status: 'loading', error: null });
        
        try {
          const { data, error } = await supabase.auth.signUp({
            email,
            password,
          });

          if (error) {
            console.error('[Auth] SignUp error:', error.message);
            let userFriendlyError = error.message;
            
            if (error.message.includes('already registered')) {
              userFriendlyError = '?¥Î? ?±Î°ù???¥Î©î?ºÏûÖ?àÎã§.';
            } else if (error.message.includes('password')) {
              userFriendlyError = 'ÎπÑÎ?Î≤àÌò∏??ÏµúÏÜå 6???¥ÏÉÅ?¥Ïñ¥???©Îãà??';
            }
            
            set({
              user: null,
              status: 'unauthenticated',
              error: userFriendlyError,
            });
            return;
          }

          if (data.user) {
            // ?åÏõêÍ∞Ä???±Í≥µ - ?¥Î©î???ïÏù∏???ÑÏöî??Í≤ΩÏö∞
            if (!data.session) {
              set({
                user: null,
                status: 'unauthenticated',
                error: '?¥Î©î?ºÎ°ú ?ÑÏÜ°???ïÏù∏ ÎßÅÌÅ¨Î•??¥Î¶≠?¥Ï£º?∏Ïöî.',
              });
              return;
            }

            set({
              user: {
                id: data.user.id,
                email: data.user.email || '',
                tier: 'free',
              },
              status: 'authenticated',
              error: null,
            });
          }
        } catch (error) {
          const errorMessage = error instanceof Error ? error.message : '?åÏõêÍ∞Ä?ÖÏóê ?§Ìå®?àÏäµ?àÎã§.';
          console.error('[Auth] SignUp exception:', errorMessage);
          set({
            user: null,
            status: 'unauthenticated',
            error: errorMessage,
          });
        }
      },

      signOut: async () => {
        try {
          const { error } = await supabase.auth.signOut();
          
          if (error) {
            console.error('[Auth] SignOut error:', error.message);
          }
          
          set({ user: null, status: 'unauthenticated', error: null });
        } catch (error) {
          console.error('[Auth] SignOut exception:', error instanceof Error ? error.message : error);
          set({ user: null, status: 'unauthenticated', error: null });
        }
      },

      clearError: () => set({ error: null }),
    }),
    {
      name: 'pockest-auth',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({ user: state.user }),
    }
  )
);

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\store\usePocketStore.ts
==========================================
import { create } from 'zustand';
import { supabase } from '@/services/supabase/client';
import { useAuthStore } from './useAuthStore';
import type { PocketWithCount, Item, ItemFilters } from '@/types';
import type { PocketInsert, ItemInsert, ItemUpdate } from '@/types/database';

interface PocketState {
  // Pockets (?¥Îçî)
  pockets: PocketWithCount[];
  selectedPocketId: string | null;
  pocketsLoading: boolean;
  pocketsError: string | null;

  // Items (?ÅÌíà)
  items: Item[];
  itemsLoading: boolean;
  itemsTotal: number;
  itemsError: string | null;

  // Filters
  filters: ItemFilters;
  currentPage: number;
  pageSize: number;

  // Actions - Pockets
  fetchPockets: () => Promise<void>;
  createPocket: (name: string) => Promise<PocketWithCount | null>;
  updatePocket: (id: string, name: string) => Promise<void>;
  deletePocket: (id: string) => Promise<void>;
  selectPocket: (id: string | null) => void;

  // Actions - Items
  fetchItems: () => Promise<void>;
  fetchTodayItems: () => Promise<void>;
  addItem: (item: Omit<Item, 'id' | 'created_at' | 'updated_at' | 'user_id'>) => Promise<Item | null>;
  updateItem: (id: string, updates: Partial<Item>) => Promise<void>;
  moveToTrash: (id: string) => Promise<void>;
  restoreFromTrash: (id: string, pocketId?: string) => Promise<void>;
  permanentDelete: (id: string) => Promise<void>;
  togglePin: (id: string) => Promise<void>;

  // Actions - Filters
  setFilters: (filters: Partial<ItemFilters>) => void;
  clearFilters: () => void;
  setPage: (page: number) => void;
}

export const usePocketStore = create<PocketState>((set, get) => ({
  // Initial state
  pockets: [],
  selectedPocketId: null,
  pocketsLoading: false,
  pocketsError: null,
  items: [],
  itemsLoading: false,
  itemsTotal: 0,
  itemsError: null,
  filters: {},
  currentPage: 1,
  pageSize: 20,

  // Pocket actions
  fetchPockets: async () => {
    // ???∏Ï¶ù Í∞Ä?? Î°úÍ∑∏?????àÏúºÎ©??îÏ≤≠?òÏ? ?äÏùå
    const { user } = useAuthStore.getState();
    if (!user) {
      console.log('[fetchPockets] ?†Ô∏è Not authenticated, skipping request');
      return;
    }

    console.log('[fetchPockets] ?îÑ Starting fetch for user:', user.id);
    // ??Î°úÎî© Ï§ëÏóê??Í∏∞Ï°¥ ?∞Ïù¥???†Ï? (0?ºÎ°ú ÍπúÎπ°??Î∞©Ï?)
    set({ pocketsLoading: true, pocketsError: null });
    
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError) {
        console.error('[fetchPockets] ??Auth error:', userError.message, userError);
        // ?êÎü¨ ?úÏóêÎß?pockets Ï¥àÍ∏∞??        set({ pocketsLoading: false, pocketsError: userError.message });
        return;
      }
      
      if (!userData.user) {
        console.warn('[fetchPockets] ?†Ô∏è No authenticated user after getUser()');
        set({ pockets: [], pocketsLoading: false, pocketsError: 'Not authenticated' });
        return;
      }

      console.log('[fetchPockets] ?ì° Querying pockets for user:', userData.user.id);
      // ???ÑÏù¥??Í∞úÏàò + ?∏ÎÑ§???¥Î?ÏßÄÎ•??®Íªò Í∞Ä?∏Ïò§Í∏?      const { data, error } = await supabase
        .from('pockets')
        .select('*, items(id, image_url, created_at)')
        .eq('user_id', userData.user.id)
        .order('is_default', { ascending: false })
        .order('created_at', { ascending: true });

      if (error) {
        console.error('[fetchPockets] ??Query error:', error.message, 'Code:', error.code, 'Details:', error.details);
        // ?êÎü¨ ??Í∏∞Ï°¥ ?∞Ïù¥???†Ï?
        set({ pocketsLoading: false, pocketsError: error.message });
        return;
      }
      
      // ???ÑÏù¥??Ïπ¥Ïö¥??+ ?∏ÎÑ§??Îß§Ìïë (?µÏã¨ Î°úÏßÅ)
      const mappedPockets: PocketWithCount[] = (data || []).map((pocket) => {
        const pocketData = pocket as Record<string, unknown>;
        const items = pocketData.items as Array<{ id: string; image_url: string | null; created_at: string }> | undefined;
        
        // ?ÑÏù¥??Í∞úÏàò
        const itemCount = items?.length || 0;
        
        // ÏµúÏã† ?ÑÏù¥??4Í∞úÏùò ?∏ÎÑ§??(created_at ?¥Î¶ºÏ∞®Ïàú ?ïÎ†¨ ??image_url ?àÎäî Í≤ÉÎßå)
        const recentThumbnails = (items || [])
          .filter(item => item.image_url) // image_url ?àÎäî Í≤ÉÎßå
          .sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime()) // ÏµúÏã†??          .slice(0, 4) // ÏµúÎ? 4Í∞?          .map(item => item.image_url as string);
        
        // items ?çÏÑ± ?úÏô∏?òÍ≥† ?òÎ®∏ÏßÄ ?çÏÑ±Îß?Ï∂îÏ∂ú
        const { items: _items, ...pocketWithoutItems } = pocketData;
        
        return {
          ...pocketWithoutItems,
          item_count: itemCount,
          recent_thumbnails: recentThumbnails,
        } as PocketWithCount;
      });
      
      console.log('[fetchPockets] ??Success! Mapped pockets:', mappedPockets.map(p => ({ 
        name: p.name, 
        item_count: p.item_count, 
        thumbnails: p.recent_thumbnails?.length 
      })));
      
      // ???±Í≥µ ?úÏóêÎß????∞Ïù¥?∞Î°ú ÍµêÏ≤¥
      set({ pockets: mappedPockets, pocketsLoading: false, pocketsError: null });
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      console.error('[fetchPockets] ??Exception:', errorMessage, error);
      // ?àÏô∏ ??Í∏∞Ï°¥ ?∞Ïù¥???†Ï?
      set({ pocketsLoading: false, pocketsError: errorMessage });
    }
  },

  createPocket: async (name) => {
    try {
      console.log('[createPocket] Starting with name:', name);
      
      const { data: userData, error: userError } = await supabase.auth.getUser();
      console.log('[createPocket] Auth result:', { user: userData?.user?.id, error: userError?.message });
      
      if (userError) {
        console.error('[createPocket] Auth error:', userError.message, userError);
        throw new Error(`?∏Ï¶ù ?§Î•ò: ${userError.message}`);
      }
      
      if (!userData.user) {
        console.error('[createPocket] No user found');
        throw new Error('Î°úÍ∑∏?∏Ïù¥ ?ÑÏöî?©Îãà??');
      }

      const insertData: PocketInsert = {
        name,
        is_default: false,
        user_id: userData.user.id,
      };
      
      console.log('[createPocket] Insert data:', insertData);

      const { data, error } = await supabase
        .from('pockets')
        .insert(insertData)
        .select()
        .single();

      if (error) {
        console.error('[createPocket] DB error:', error.message, error.code, error.details, error.hint);
        throw new Error(`DB ?§Î•ò: ${error.message}`);
      }
      
      console.log('[createPocket] Success:', data);
      
      // ???ùÏÑ± ?±Í≥µ ???úÎ≤Ñ?êÏÑú ?ÑÏ≤¥ ?∞Ïù¥???¨Ï°∞??(Í∞ïÏ†ú ?ôÍ∏∞??
      // Î°úÏª¨ Î∞∞Ïó¥ Ï°∞Ïûë ?ÜÏù¥ fetchPockets()Î°??ÑÏ†Ñ????ñ¥?åÏ?
      await get().fetchPockets();
      
      // ?àÎ°ú ?ùÏÑ±???¨Ïºì??ÏµúÏã† ?ÅÌÉú?êÏÑú Ï∞æÏïÑ??Î∞òÌôò
      const newPocket = get().pockets.find(p => p.id === data.id);
      return newPocket || (data as PocketWithCount);
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : '?????ÜÎäî ?§Î•ò';
      console.error('[createPocket] Exception:', errorMessage, error);
      throw error;
    }
  },

  updatePocket: async (id, name) => {
    try {
      const { error } = await supabase
        .from('pockets')
        .update({ name } as { name: string })
        .eq('id', id);

      if (error) {
        console.error('[updatePocket] Error:', error.message);
        return;
      }
      
      set((state) => ({
        pockets: state.pockets.map((p) =>
          p.id === id ? { ...p, name } : p
        ),
      }));
    } catch (error) {
      console.error('[updatePocket] Exception:', error instanceof Error ? error.message : error);
    }
  },

  deletePocket: async (id) => {
    try {
      const { error } = await supabase.from('pockets').delete().eq('id', id);
      
      if (error) {
        console.error('[deletePocket] Error:', error.message);
        return;
      }
      
      set((state) => ({
        pockets: state.pockets.filter((p) => p.id !== id),
        selectedPocketId:
          state.selectedPocketId === id ? null : state.selectedPocketId,
      }));
    } catch (error) {
      console.error('[deletePocket] Exception:', error instanceof Error ? error.message : error);
    }
  },

  selectPocket: (id) => {
    set({ selectedPocketId: id, currentPage: 1 });
    get().fetchItems();
  },

  // Item actions
  fetchItems: async () => {
    // ???∏Ï¶ù Í∞Ä?? Î°úÍ∑∏?????àÏúºÎ©??îÏ≤≠?òÏ? ?äÏùå
    const { user } = useAuthStore.getState();
    if (!user) {
      console.log('[fetchItems] ?†Ô∏è Not authenticated, skipping request');
      return;
    }

    console.log('[fetchItems] ?îÑ Starting fetch for user:', user.id);
    set({ itemsLoading: true, itemsError: null });
    const { selectedPocketId, filters, currentPage, pageSize } = get();

    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError) {
        console.error('[fetchItems] ??Auth error:', userError.message, userError);
        set({ items: [], itemsLoading: false, itemsError: userError.message });
        return;
      }
      
      if (!userData.user) {
        console.warn('[fetchItems] ?†Ô∏è No authenticated user after getUser()');
        set({ items: [], itemsLoading: false, itemsError: 'Not authenticated' });
        return;
      }

      let query = supabase
        .from('items')
        .select('*', { count: 'exact' })
        .eq('user_id', userData.user.id)
        .is('deleted_at', null);

      if (selectedPocketId) {
        query = query.eq('pocket_id', selectedPocketId);
      }

      if (filters.isPinned !== undefined) {
        query = query.eq('is_pinned', filters.isPinned);
      }
      if (filters.search) {
        query = query.ilike('title', `%${filters.search}%`);
      }
      if (filters.minPrice !== undefined) {
        query = query.gte('price', filters.minPrice);
      }
      if (filters.maxPrice !== undefined) {
        query = query.lte('price', filters.maxPrice);
      }
      if (filters.siteName) {
        query = query.eq('site_name', filters.siteName);
      }

      const from = (currentPage - 1) * pageSize;
      const to = from + pageSize - 1;

      const { data, error, count } = await query
        .order('created_at', { ascending: false })
        .range(from, to);

      if (error) {
        console.error('[fetchItems] ??Query error:', error.message, 'Code:', error.code, 'Details:', error.details);
        set({ items: [], itemsLoading: false, itemsError: error.message });
        return;
      }
      
      console.log('[fetchItems] ??Success! Fetched', data?.length || 0, 'items (total:', count, ')');
      set({
        items: (data as Item[]) || [],
        itemsTotal: count || 0,
        itemsLoading: false,
        itemsError: null,
      });
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      console.error('[fetchItems] ??Exception:', errorMessage, error);
      set({ items: [], itemsLoading: false, itemsError: errorMessage });
    }
  },

  fetchTodayItems: async () => {
    // ???∏Ï¶ù Í∞Ä?? Î°úÍ∑∏?????àÏúºÎ©??îÏ≤≠?òÏ? ?äÏùå
    const { user } = useAuthStore.getState();
    if (!user) {
      console.log('[fetchTodayItems] ?†Ô∏è Not authenticated, skipping request');
      return;
    }

    console.log('[fetchTodayItems] ?îÑ Starting fetch for user:', user.id);
    set({ itemsLoading: true, itemsError: null });
    
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError || !userData.user) {
        console.error('[fetchTodayItems] ??Auth error:', userError?.message, userError);
        set({ items: [], itemsLoading: false, itemsError: 'Not authenticated' });
        return;
      }

      // 1. RPC ?∏Ï∂ú ?úÎèÑ
      const { data, error } = await supabase
        .rpc('get_today_items', { p_user_id: userData.user.id });

      if (error) {
        console.warn('[fetchTodayItems] ?†Ô∏è RPC failed, falling back to standard query:', JSON.stringify(error, null, 2));
        
        // 2. Fallback: ?ºÎ∞ò Select ÏøºÎ¶¨Î°??§Îäò(24?úÍ∞Ñ ?¥ÎÇ¥) ?∞Ïù¥??Ï°∞Ìöå
        // 24?úÍ∞Ñ ?¥ÎÇ¥ Í∏∞Ï?
        const oneDayAgo = new Date();
        oneDayAgo.setHours(oneDayAgo.getHours() - 24);
        
        console.log('[fetchTodayItems] ?îÑ Executing fallback query from:', oneDayAgo.toISOString());

        const { data: fallbackData, error: fallbackError } = await supabase
          .from('items')
          .select('*')
          .eq('user_id', userData.user.id)
          .gte('created_at', oneDayAgo.toISOString())
          .is('deleted_at', null)
          .order('created_at', { ascending: false });

        if (fallbackError) {
          console.error('[fetchTodayItems] ??Fallback query failed:', fallbackError.message);
          set({ items: [], itemsLoading: false, itemsError: fallbackError.message });
          return;
        }

        console.log('[fetchTodayItems] ??Success (Fallback)! Fetched', fallbackData?.length || 0, 'items');
        set({ items: (fallbackData as Item[]) || [], itemsLoading: false, itemsError: null });
        return;
      }
      
      // RPC ?±Í≥µ ??      console.log('[fetchTodayItems] ??Success (RPC)! Fetched', data?.length || 0, 'today items');
      set({ items: (data as Item[]) || [], itemsLoading: false, itemsError: null });

    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : 'Unknown error';
      console.error('[fetchTodayItems] ??Exception:', errorMessage, error);
      set({ items: [], itemsLoading: false, itemsError: errorMessage });
    }
  },

  addItem: async (item) => {
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError || !userData.user) {
        console.error('[addItem] Auth error:', userError?.message || 'Not authenticated');
        return null;
      }

      const insertData: ItemInsert = {
        user_id: userData.user.id,
        url: item.url,
        title: item.title,
        price: item.price,
        currency: item.currency,
        image_url: item.image_url,
        site_name: item.site_name,
        pocket_id: item.pocket_id,
        is_pinned: item.is_pinned,
        memo: item.memo,
        deleted_at: item.deleted_at,
      };

      const { data, error } = await supabase
        .from('items')
        .insert(insertData)
        .select()
        .single();

      if (error) {
        console.error('[addItem] ??Error:', error.message, 'Code:', error.code);
        return null;
      }
      
      const newItem = data as Item;
      console.log('[addItem] ??Item added successfully, refreshing all lists');
      
      // ???ÑÏù¥??Ï∂îÍ? ???¨Ïºì + ?ÑÏù¥??+ Today Î¶¨Ïä§??Î™®Îëê ?¨Ï°∞??      // (Ïπ¥Ïö¥??+ ?∏ÎÑ§??+ Today ?ôÍ∏∞??
      try {
        await Promise.all([
          get().fetchPockets(),      // 1. ?¨Ïºì Î™©Î°ù(Ïπ¥Ïö¥?? Í∞±Ïã†
          get().fetchItems(),        // 2. ?ÑÏû¨ ?¨Ïºì ?ÑÏù¥??Í∞±Ïã†
          get().fetchTodayItems()    // 3. Today Î¶¨Ïä§??Í∞±Ïã† (?ÑÏàò!)
        ]);
        console.log('[addItem] ?îÑ All lists refreshed successfully');
      } catch (refreshError) {
        // fetch ?®Ïàò?§Ï? ?¥Î??ÅÏúºÎ°??êÎü¨Î•?Ï≤òÎ¶¨?òÏ?Îß? ?πÏãú Î™®Î? ?êÎü¨Î•?catch
        console.error('[addItem] ?†Ô∏è Error during refresh:', refreshError);
      }
      
      return newItem;
    } catch (error) {
      console.error('[addItem] Exception:', error instanceof Error ? error.message : error);
      return null;
    }
  },

  updateItem: async (id, updates) => {
    try {
      const updateData: ItemUpdate = { ...updates };

      const { error } = await supabase
        .from('items')
        .update(updateData)
        .eq('id', id);

      if (error) {
        console.error('[updateItem] Error:', error.message);
        return;
      }
      
      set((state) => ({
        items: state.items.map((item) =>
          item.id === id ? { ...item, ...updates } : item
        ),
      }));
    } catch (error) {
      console.error('[updateItem] Exception:', error instanceof Error ? error.message : error);
    }
  },

  moveToTrash: async (id) => {
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError || !userData.user) {
        console.error('[moveToTrash] Auth error');
        return;
      }

      const { error } = await supabase
        .rpc('move_item_to_trash', {
          p_item_id: id,
          p_user_id: userData.user.id,
        });

      if (error) {
        console.error('[moveToTrash] Error:', error.message);
        return;
      }
      
      set((state) => ({
        items: state.items.filter((item) => item.id !== id),
      }));
    } catch (error) {
      console.error('[moveToTrash] Exception:', error instanceof Error ? error.message : error);
    }
  },

  restoreFromTrash: async (id, pocketId) => {
    try {
      const { data: userData, error: userError } = await supabase.auth.getUser();
      
      if (userError || !userData.user) {
        console.error('[restoreFromTrash] Auth error');
        return;
      }

      const { error } = await supabase
        .rpc('restore_item_from_trash', {
          p_item_id: id,
          p_user_id: userData.user.id,
          p_pocket_id: pocketId,
        });

      if (error) {
        console.error('[restoreFromTrash] Error:', error.message);
        return;
      }
      
      get().fetchItems();
    } catch (error) {
      console.error('[restoreFromTrash] Exception:', error instanceof Error ? error.message : error);
    }
  },

  permanentDelete: async (id) => {
    try {
      const { error } = await supabase.from('items').delete().eq('id', id);
      
      if (error) {
        console.error('[permanentDelete] Error:', error.message);
        return;
      }
      
      set((state) => ({
        items: state.items.filter((item) => item.id !== id),
      }));
    } catch (error) {
      console.error('[permanentDelete] Exception:', error instanceof Error ? error.message : error);
    }
  },

  togglePin: async (id) => {
    const item = get().items.find((i) => i.id === id);
    if (!item) return;

    await get().updateItem(id, { is_pinned: !item.is_pinned });
  },

  // Filter actions
  setFilters: (newFilters) => {
    set((state) => ({
      filters: { ...state.filters, ...newFilters },
      currentPage: 1,
    }));
    get().fetchItems();
  },

  clearFilters: () => {
    set({ filters: {}, currentPage: 1 });
    get().fetchItems();
  },

  setPage: (page) => {
    set({ currentPage: page });
    get().fetchItems();
  },
}));

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\types\database.ts
==========================================
/**
 * Supabase ?∞Ïù¥?∞Î≤†?¥Ïä§ ?Ä???ïÏùò
 * schema.sql Í∏∞Î∞ò TypeScript ?Ä?? */

export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[];

export type Database = {
  public: {
    Tables: {
      profiles: {
        Row: {
          id: string;
          email: string;
          tier: 'free' | 'premium';
          created_at: string;
          updated_at: string;
        };
        Insert: {
          id: string;
          email: string;
          tier?: 'free' | 'premium';
          created_at?: string;
          updated_at?: string;
        };
        Update: {
          id?: string;
          email?: string;
          tier?: 'free' | 'premium';
          created_at?: string;
          updated_at?: string;
        };
        Relationships: [];
      };
      pockets: {
        Row: {
          id: string;
          user_id: string;
          name: string;
          is_default: boolean;
          created_at: string;
          updated_at: string;
        };
        Insert: {
          id?: string;
          user_id: string;
          name: string;
          is_default?: boolean;
          created_at?: string;
          updated_at?: string;
        };
        Update: {
          id?: string;
          user_id?: string;
          name?: string;
          is_default?: boolean;
          created_at?: string;
          updated_at?: string;
        };
        Relationships: [
          {
            foreignKeyName: "pockets_user_id_fkey";
            columns: ["user_id"];
            isOneToOne: false;
            referencedRelation: "profiles";
            referencedColumns: ["id"];
          }
        ];
      };
      items: {
        Row: {
          id: string;
          user_id: string;
          pocket_id: string | null;
          url: string;
          image_url: string | null;
          site_name: string | null;
          title: string;
          price: number | null;
          currency: string | null;
          is_pinned: boolean;
          memo: string | null;
          created_at: string;
          updated_at: string;
          deleted_at: string | null;
        };
        Insert: {
          id?: string;
          user_id: string;
          pocket_id?: string | null;
          url: string;
          image_url?: string | null;
          site_name?: string | null;
          title: string;
          price?: number | null;
          currency?: string | null;
          is_pinned?: boolean;
          memo?: string | null;
          created_at?: string;
          updated_at?: string;
          deleted_at?: string | null;
        };
        Update: {
          id?: string;
          user_id?: string;
          pocket_id?: string | null;
          url?: string;
          image_url?: string | null;
          site_name?: string | null;
          title?: string;
          price?: number | null;
          currency?: string | null;
          is_pinned?: boolean;
          memo?: string | null;
          created_at?: string;
          updated_at?: string;
          deleted_at?: string | null;
        };
        Relationships: [
          {
            foreignKeyName: "items_user_id_fkey";
            columns: ["user_id"];
            isOneToOne: false;
            referencedRelation: "profiles";
            referencedColumns: ["id"];
          },
          {
            foreignKeyName: "items_pocket_id_fkey";
            columns: ["pocket_id"];
            isOneToOne: false;
            referencedRelation: "pockets";
            referencedColumns: ["id"];
          }
        ];
      };
    };
    Views: {
      active_items: {
        Row: {
          id: string | null;
          user_id: string | null;
          pocket_id: string | null;
          url: string | null;
          image_url: string | null;
          site_name: string | null;
          title: string | null;
          price: number | null;
          currency: string | null;
          is_pinned: boolean | null;
          memo: string | null;
          created_at: string | null;
          updated_at: string | null;
          deleted_at: string | null;
          pocket_name: string | null;
        };
        Relationships: [];
      };
      trash_items: {
        Row: {
          id: string | null;
          user_id: string | null;
          pocket_id: string | null;
          url: string | null;
          image_url: string | null;
          site_name: string | null;
          title: string | null;
          price: number | null;
          currency: string | null;
          is_pinned: boolean | null;
          memo: string | null;
          created_at: string | null;
          updated_at: string | null;
          deleted_at: string | null;
        };
        Relationships: [];
      };
    };
    Functions: {
      get_today_items: {
        Args: { p_user_id: string };
        Returns: {
          id: string;
          user_id: string;
          pocket_id: string | null;
          url: string;
          image_url: string | null;
          site_name: string | null;
          title: string;
          price: number | null;
          currency: string | null;
          is_pinned: boolean;
          memo: string | null;
          created_at: string;
          updated_at: string;
          deleted_at: string | null;
        }[];
      };
      move_item_to_trash: {
        Args: { p_item_id: string; p_user_id: string };
        Returns: boolean;
      };
      restore_item_from_trash: {
        Args: { p_item_id: string; p_user_id: string; p_pocket_id?: string };
        Returns: boolean;
      };
      empty_trash_older_than: {
        Args: { days?: number };
        Returns: number;
      };
    };
    Enums: {
      [_ in never]: never;
    };
    CompositeTypes: {
      [_ in never]: never;
    };
  };
};

// ?∏Ïùò???Ä??Î≥ÑÏπ≠
export type Profile = Database['public']['Tables']['profiles']['Row'];
export type ProfileInsert = Database['public']['Tables']['profiles']['Insert'];
export type ProfileUpdate = Database['public']['Tables']['profiles']['Update'];

export type Pocket = Database['public']['Tables']['pockets']['Row'];
export type PocketInsert = Database['public']['Tables']['pockets']['Insert'];
export type PocketUpdate = Database['public']['Tables']['pockets']['Update'];

export type Item = Database['public']['Tables']['items']['Row'];
export type ItemInsert = Database['public']['Tables']['items']['Insert'];
export type ItemUpdate = Database['public']['Tables']['items']['Update'];

export type ActiveItem = Database['public']['Views']['active_items']['Row'];
export type TrashItem = Database['public']['Views']['trash_items']['Row'];

// Tables helper type
export type Tables<T extends keyof Database['public']['Tables']> = Database['public']['Tables'][T]['Row'];
export type TablesInsert<T extends keyof Database['public']['Tables']> = Database['public']['Tables'][T]['Insert'];
export type TablesUpdate<T extends keyof Database['public']['Tables']> = Database['public']['Tables'][T]['Update'];

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\types\index.ts
==========================================
/**
 * Í≥µÌÜµ ?Ä???ïÏùò
 */

// ?∏Ï¶ù ?ÅÌÉú
export type AuthStatus = 'loading' | 'authenticated' | 'unauthenticated';

// ?†Ï? ?ïÎ≥¥
export interface User {
  id: string;
  email: string;
  tier: 'free' | 'premium';
}

// ?ÅÌíà ?Ä???îÏ≤≠ (Content Script -> Popup)
export interface SaveItemRequest {
  url: string;
  title: string;
  imageUrl?: string;
  siteName?: string;
  price?: number;
  currency?: string;
}

// Î©îÏãúÏßÄ ?Ä??(Extension ?¥Î? ?µÏã†)
export type MessageType =
  | 'SAVE_ITEM'
  | 'GET_PAGE_INFO'
  | 'AUTH_STATE_CHANGED'
  | 'SYNC_REQUEST';

export interface ExtensionMessage<T = unknown> {
  type: MessageType;
  payload?: T;
}

// API ?ëÎãµ ?òÌçº
export interface ApiResponse<T> {
  data: T | null;
  error: string | null;
  success: boolean;
}

// ?òÏù¥ÏßÄ?§Ïù¥??export interface PaginationParams {
  page: number;
  limit: number;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  limit: number;
  hasMore: boolean;
}

// ?ïÎ†¨ ?µÏÖò
export type SortOrder = 'asc' | 'desc';

export interface SortOption {
  field: string;
  order: SortOrder;
}

// ?ÑÌÑ∞ ?µÏÖò
export interface ItemFilters {
  pocketId?: string;
  isPinned?: boolean;
  search?: string;
  minPrice?: number;
  maxPrice?: number;
  siteName?: string;
}

// Re-export database types
export * from './database';

// Pocket with item count and thumbnails (?ïÏû• ?Ä??
import type { Pocket as BasePocket } from './database';
export interface PocketWithCount extends BasePocket {
  item_count?: number;
  recent_thumbnails?: string[]; // ÏµúÏã† ?ÑÏù¥??4Í∞úÏùò ?¥Î?ÏßÄ URL
}

// Re-export parser types
export type { ProductData } from '@/utils/parser';


==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\utils\cn.ts
==========================================
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

/**
 * Tailwind CSS ?¥Îûò??Î≥ëÌï© ?†Ìã∏Î¶¨Ìã∞
 * clsx + tailwind-merge Ï°∞Ìï©
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\utils\format.ts
==========================================
/**
 * ?¨Îß∑???†Ìã∏Î¶¨Ìã∞ ?®Ïàò
 */

/**
 * Í∞ÄÍ≤??¨Îß∑??
 */
export function formatPrice(price: number, currency: string = 'KRW'): string {
  return new Intl.NumberFormat('ko-KR', {
    style: 'currency',
    currency,
    maximumFractionDigits: 0,
  }).format(price);
}

/**
 * ?ÅÎ? ?úÍ∞Ñ ?¨Îß∑??(?? "3?úÍ∞Ñ ??)
 */
export function formatRelativeTime(date: string | Date): string {
  const now = new Date();
  const target = new Date(date);
  const diffMs = now.getTime() - target.getTime();
  const diffSec = Math.floor(diffMs / 1000);
  const diffMin = Math.floor(diffSec / 60);
  const diffHour = Math.floor(diffMin / 60);
  const diffDay = Math.floor(diffHour / 24);

  if (diffSec < 60) return 'Î∞©Í∏à ??;
  if (diffMin < 60) return `${diffMin}Î∂???;
  if (diffHour < 24) return `${diffHour}?úÍ∞Ñ ??;
  if (diffDay < 7) return `${diffDay}????;
  if (diffDay < 30) return `${Math.floor(diffDay / 7)}Ï£???;
  if (diffDay < 365) return `${Math.floor(diffDay / 30)}Í∞úÏõî ??;
  return `${Math.floor(diffDay / 365)}????;
}

/**
 * ?†Ïßú ?¨Îß∑??
 */
export function formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {
  return new Intl.DateTimeFormat('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    ...options,
  }).format(new Date(date));
}

/**
 * URL?êÏÑú ?ÑÎ©î??Ï∂îÏ∂ú
 */
export function extractDomain(url: string): string {
  try {
    const hostname = new URL(url).hostname;
    return hostname.replace('www.', '');
  } catch {
    return url;
  }
}

/**
 * ?çÏä§???êÎ•¥Í∏?(ÎßêÏ§Ñ?ÑÌëú)
 */
export function truncate(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength - 3) + '...';
}






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\utils\index.ts
==========================================
export * from './cn';
export * from './format';






==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\utils\parser.ts
==========================================
/**
 * ?ÅÌíà ?åÏÑú(Parser) ?îÏßÑ v2.0
 * ?ºÌïëÎ™??òÏù¥ÏßÄ?êÏÑú ?ÅÌíà ?ïÎ≥¥Î•?Ï∂îÏ∂ú?òÎäî ?úÏàò ?®Ïàò ÏßëÌï©
 * 
 * Í∞úÏÑ† ?¨Ìï≠:
 * - ?§Ï§ë ?¥Î?ÏßÄ ?ÑÎ≥¥Íµ?Ï∂îÏ∂ú ÏßÄ?? * - ?ºÌïëÎ™∞Î≥Ñ ?ÅÏÑ∏ ?¥Î?ÏßÄ ?¥Îûò??Í∞êÏ?
 * - Í¥ëÍ≥†/Î∞∞ÎÑà ?¥Î?ÏßÄ ?ÑÌÑ∞Îß? * 
 * ?∞ÏÑ†?úÏúÑ ?ÑÎûµ:
 * 1. Meta Tags (og:*, twitter:*, product:*)
 * 2. JSON-LD (Structured Data)
 * 3. DOM Analysis (Fallback)
 */

// ============================================================
// ?Ä???ïÏùò
// ============================================================

export interface ProductData {
  title: string;
  price: number | null;
  currency: string;
  imageUrl: string;           // ?Ä???¥Î?ÏßÄ (Ï≤?Î≤àÏß∏)
  imageUrls: string[];        // ?¥Î?ÏßÄ ?ÑÎ≥¥Íµ?(Î∞∞Ïó¥)
  mallName: string;
  url: string;
}

interface JsonLdProduct {
  '@type'?: string;
  name?: string;
  image?: string | string[];
  offers?: {
    price?: string | number;
    priceCurrency?: string;
  } | Array<{
    price?: string | number;
    priceCurrency?: string;
  }>;
}

// Í¥ëÍ≥†/Î∞∞ÎÑà ?¥Î?ÏßÄ ?ÑÌÑ∞Îß??§Ïõå??const EXCLUDED_IMAGE_KEYWORDS = [
  'ad', 'banner', 'advertisement', 'promotion', 'promo',
  'logo', 'icon', 'btn', 'button', 'arrow', 'cart', 'search',
  'spinner', 'loading', 'placeholder', 'blank', 'empty',
  'social', 'facebook', 'twitter', 'instagram', 'kakao',
  'payment', 'card', 'delivery', 'shipping', 'badge',
  'star', 'rating', 'review', 'like', 'heart', 'share',
];

// ?ºÌïëÎ™∞Î≥Ñ ?ÅÌíà ?¥Î?ÏßÄ ?†ÌÉù??const MALL_IMAGE_SELECTORS: Record<string, string[]> = {
  // ?§Ïù¥Î≤??ºÌïë/?§Îßà?∏Ïä§?†Ïñ¥
  'smartstore.naver.com': ['._image', '.product-img img', '.thumb_image img'],
  'shopping.naver.com': ['.productImage img', '.thumb img'],
  'brand.naver.com': ['.product_thumb img', '._image'],
  // Ïø†Ìå°
  'coupang.com': ['.prod-image__detail img', '.prod-image img', '.subType-IMAGE img'],
  // 11Î≤àÍ?
  '11st.co.kr': ['.img_full img', '.c_product_img img', '.thumb img'],
  // GÎßàÏºì
  'gmarket.co.kr': ['.thumb-gallery img', '.thumb_img img', '.item_photo img'],
  // ?•ÏÖò
  'auction.co.kr': ['.thumb-gallery img', '.thumb_img img', '.item_photo img'],
  // SSG
  'ssg.com': ['.cdtl_img img', '.v2_detail img', '.cdtl_item img'],
  // Î°?ç∞??  'lotteon.com': ['.prd_img img', '.thumb img'],
  // Î¨¥Ïã†??  'musinsa.com': ['.product-img img', '.prd_img img', '.img-box img'],
  // 29cm
  '29cm.co.kr': ['.detail-image img', '.prd_img img'],
  // WÏª®ÏÖâ
  'wconcept.co.kr': ['.prd_img img', '.thumb img'],
  // ?ÑÎßàÏ°?  'amazon': ['.imgTagWrapper img', '#landingImage', '#imgBlkFront', '.image-wrapper img'],
  // ?åÎ¶¨?µÏä§?ÑÎ†à??  'aliexpress': ['.image-view-magnifier-wrap img', '.images-view-item img'],
};

// ============================================================
// Î©îÌ? ?úÍ∑∏ ?†Ìã∏Î¶¨Ìã∞
// ============================================================

/**
 * Meta ?úÍ∑∏?êÏÑú content Í∞?Ï∂îÏ∂ú
 */
function getMetaContent(doc: Document, selectors: string[]): string {
  for (const selector of selectors) {
    const meta = doc.querySelector(selector);
    if (meta) {
      const content = meta.getAttribute('content');
      if (content && content.trim()) {
        return content.trim();
      }
    }
  }
  return '';
}

/**
 * JSON-LD ?§ÌÅ¨Î¶ΩÌä∏?êÏÑú Product ?∞Ïù¥??Ï∂îÏ∂ú
 */
function parseJsonLd(doc: Document): JsonLdProduct | null {
  const scripts = doc.querySelectorAll('script[type="application/ld+json"]');
  
  for (const script of scripts) {
    try {
      const data = JSON.parse(script.textContent || '');
      
      // ?®Ïùº Í∞ùÏ≤¥??Í≤ΩÏö∞
      if (data['@type'] === 'Product') {
        return data as JsonLdProduct;
      }
      
      // @graph Î∞∞Ïó¥??Í≤ΩÏö∞
      if (data['@graph'] && Array.isArray(data['@graph'])) {
        const product = data['@graph'].find(
          (item: JsonLdProduct) => item['@type'] === 'Product'
        );
        if (product) return product as JsonLdProduct;
      }
      
      // Î∞∞Ïó¥??Í≤ΩÏö∞
      if (Array.isArray(data)) {
        const product = data.find(
          (item: JsonLdProduct) => item['@type'] === 'Product'
        );
        if (product) return product as JsonLdProduct;
      }
    } catch {
      continue;
    }
  }
  
  return null;
}

// ============================================================
// ?¥Î?ÏßÄ Ï∂îÏ∂ú (?§Ï§ë ?¥Î?ÏßÄ ÏßÄ??
// ============================================================

/**
 * ?¥Î?ÏßÄÍ∞Ä ?†Ìö®?úÏ? Í≤ÄÏ¶?(Í¥ëÍ≥†/?ÑÏù¥ÏΩ??úÏô∏)
 */
function isValidProductImage(src: string): boolean {
  if (!src || src.startsWith('data:')) return false;
  
  const srcLower = src.toLowerCase();
  
  // ?úÏô∏ ?§Ïõå??Ï≤¥ÌÅ¨
  for (const keyword of EXCLUDED_IMAGE_KEYWORDS) {
    if (srcLower.includes(keyword)) {
      return false;
    }
  }
  
  // ?ïÏû•??Ï≤¥ÌÅ¨ (gif ?úÏô∏ - ?ÄÎ∂ÄÎ∂??ÑÏù¥ÏΩ?
  if (srcLower.endsWith('.gif') || srcLower.endsWith('.svg')) {
    return false;
  }
  
  return true;
}

/**
 * ?¥Î?ÏßÄ URL?êÏÑú ?§Ï†ú ?åÏä§ Ï∂îÏ∂ú (Lazy Loading ?Ä??
 */
function extractImageSrc(img: HTMLImageElement): string {
  return img.src || 
         img.getAttribute('data-src') || 
         img.getAttribute('data-original') ||
         img.getAttribute('data-lazy-src') ||
         img.getAttribute('data-image') ||
         img.getAttribute('data-lazy') ||
         img.getAttribute('data-zoom-image') ||
         img.getAttribute('data-large-image') ||
         '';
}

/**
 * ?ºÌïëÎ™∞Î≥Ñ ?ÅÌíà ?¥Î?ÏßÄ Ï∂îÏ∂ú
 */
function getMallSpecificImages(doc: Document, hostname: string): string[] {
  const images: string[] = [];
  
  // Îß§Ïπ≠?òÎäî ?ºÌïëÎ™??†ÌÉù??Ï∞æÍ∏∞
  for (const [mall, selectors] of Object.entries(MALL_IMAGE_SELECTORS)) {
    if (hostname.includes(mall)) {
      for (const selector of selectors) {
        const elements = doc.querySelectorAll(selector);
        elements.forEach((el) => {
          const src = el instanceof HTMLImageElement 
            ? extractImageSrc(el)
            : el.getAttribute('src') || '';
          if (isValidProductImage(src)) {
            images.push(resolveUrl(src, doc));
          }
        });
      }
      break;
    }
  }
  
  return [...new Set(images)]; // Ï§ëÎ≥µ ?úÍ±∞
}

/**
 * Î≥∏Î¨∏?êÏÑú ???¥Î?ÏßÄ??Ï∞æÍ∏∞ (300px ?¥ÏÉÅ)
 */
function findLargeImages(doc: Document): string[] {
  const images = doc.querySelectorAll('img');
  const candidates: Array<{ src: string; area: number }> = [];
  const MIN_SIZE = 300;

  for (const img of images) {
    const src = extractImageSrc(img);
    if (!isValidProductImage(src)) continue;

    // ?¨Í∏∞ ?ïÏù∏ (?êÏó∞ ?¨Í∏∞ ?êÎäî ?çÏÑ±Í∞?
    const width = img.naturalWidth || parseInt(img.getAttribute('width') || '0', 10);
    const height = img.naturalHeight || parseInt(img.getAttribute('height') || '0', 10);
    
    // ÏµúÏÜå ?¨Í∏∞ Ï≤¥ÌÅ¨
    if (width >= MIN_SIZE || height >= MIN_SIZE) {
      // ÎπÑÏú® Ï≤¥ÌÅ¨ (?àÎ¨¥ Í∞ÄÎ°úÎ°ú Í∏??¥Î?ÏßÄ??Î∞∞ÎÑà??Í∞Ä?•ÏÑ±)
      const ratio = width / (height || 1);
      if (ratio > 0.3 && ratio < 4) { // ?∏Î°ú 3:1 ~ Í∞ÄÎ°?4:1 ?¨Ïù¥Îß??àÏö©
        candidates.push({ src: resolveUrl(src, doc), area: width * height });
      }
    }
  }

  // ?¨Í∏∞ ?úÏúºÎ°??ïÎ†¨ ???ÅÏúÑ 10Í∞?Î∞òÌôò
  return candidates
    .sort((a, b) => b.area - a.area)
    .slice(0, 10)
    .map((c) => c.src);
}

/**
 * ?ÅÌíà ?¥Î?ÏßÄ ?ÑÎ≥¥Íµ?Ï∂îÏ∂ú (Î∞∞Ïó¥)
 * ?∞ÏÑ†?úÏúÑ: og:image ???ºÌïëÎ™∞Î≥Ñ ?†ÌÉù???????¥Î?ÏßÄ?? */
export function getProductImages(doc: Document): string[] {
  const imageSet = new Set<string>();
  const hostname = doc.location?.hostname || '';

  // 1?úÏúÑ: Open Graph ?¥Î?ÏßÄ
  const ogImages = [
    getMetaContent(doc, ['meta[property="og:image"]']),
    getMetaContent(doc, ['meta[property="og:image:url"]']),
    getMetaContent(doc, ['meta[property="og:image:secure_url"]']),
  ].filter(Boolean);
  
  ogImages.forEach((img) => {
    const resolved = resolveUrl(img, doc);
    if (isValidProductImage(resolved)) {
      imageSet.add(resolved);
    }
  });

  // 2?úÏúÑ: link rel="image_src"
  const linkImage = doc.querySelector('link[rel="image_src"]');
  if (linkImage) {
    const href = linkImage.getAttribute('href');
    if (href && isValidProductImage(href)) {
      imageSet.add(resolveUrl(href, doc));
    }
  }

  // 3?úÏúÑ: JSON-LD ?¥Î?ÏßÄ
  const jsonLd = parseJsonLd(doc);
  if (jsonLd?.image) {
    const jsonImages = Array.isArray(jsonLd.image) ? jsonLd.image : [jsonLd.image];
    jsonImages.forEach((img) => {
      if (img && isValidProductImage(img)) {
        imageSet.add(resolveUrl(img, doc));
      }
    });
  }

  // 4?úÏúÑ: ?ºÌïëÎ™∞Î≥Ñ ?ÅÌíà ?¥Î?ÏßÄ
  const mallImages = getMallSpecificImages(doc, hostname);
  mallImages.forEach((img) => imageSet.add(img));

  // 5?úÏúÑ: Î≥∏Î¨∏ ?????¥Î?ÏßÄ??(300px ?¥ÏÉÅ)
  const largeImages = findLargeImages(doc);
  largeImages.forEach((img) => imageSet.add(img));

  return Array.from(imageSet).slice(0, 10); // ÏµúÎ? 10Í∞?}

/**
 * ?Ä???¥Î?ÏßÄ URL Ï∂îÏ∂ú (?òÏúÑ ?∏Ìôò??
 */
export function getProductImage(doc: Document): string {
  const images = getProductImages(doc);
  return images[0] || '';
}

// ============================================================
// ?úÎ™© Ï∂îÏ∂ú
// ============================================================

/**
 * ?ÅÌíà ?úÎ™© Ï∂îÏ∂ú
 * ?∞ÏÑ†?úÏúÑ: og:title ??twitter:title ??JSON-LD name ??title ?úÍ∑∏ ??h1 ?úÍ∑∏ ??placeholder
 */
export function getProductTitle(doc: Document): string {
  // 1?úÏúÑ: Open Graph ?úÎ™©
  const ogTitle = getMetaContent(doc, ['meta[property="og:title"]']);
  if (ogTitle && ogTitle.trim()) return cleanTitle(ogTitle);

  // 2?úÏúÑ: Twitter ?úÎ™©
  const twitterTitle = getMetaContent(doc, [
    'meta[name="twitter:title"]',
    'meta[property="twitter:title"]',
  ]);
  if (twitterTitle && twitterTitle.trim()) return cleanTitle(twitterTitle);

  // 3?úÏúÑ: JSON-LD ?úÎ™©
  const jsonLd = parseJsonLd(doc);
  if (jsonLd?.name && jsonLd.name.trim()) return cleanTitle(jsonLd.name);

  // 4?úÏúÑ: document.title (title ?úÍ∑∏)
  if (doc.title && doc.title.trim()) {
    const cleaned = cleanTitle(doc.title);
    if (cleaned) return cleaned;
  }

  // 5?úÏúÑ: h1 ?úÍ∑∏ ?çÏä§??  const h1 = doc.querySelector('h1');
  if (h1 && h1.textContent?.trim()) {
    return cleanTitle(h1.textContent);
  }

  // 6?úÏúÑ: ?ÅÌíà Í¥Ä???¥Îûò?§Ïùò ?úÎ™© ?îÏÜå
  const productTitleSelectors = [
    '.product-title', '.product_title', '.prd_name', '.item_name',
    '.goods_name', '.tit_prd', '[class*="product"][class*="title"]',
    '[class*="product"][class*="name"]', '.name h1', '.title h1',
  ];
  for (const selector of productTitleSelectors) {
    const el = doc.querySelector(selector);
    if (el && el.textContent?.trim()) {
      return cleanTitle(el.textContent);
    }
  }

  // Fallback: placeholder Î∞òÌôò
  return '?ÅÌíàÎ™??ÜÏùå (?òÏ†ï?¥Ï£º?∏Ïöî)';
}

/**
 * ?úÎ™© ?ïÎ¶¨ (?¨Ïù¥?∏Î™Ö ?úÍ±∞ ??
 */
function cleanTitle(title: string): string {
  const separators = [' | ', ' - ', ' :: ', ' ¬ª ', ' ??', ' ¬∑ '];
  
  for (const sep of separators) {
    if (title.includes(sep)) {
      const parts = title.split(sep);
      return parts.reduce((a, b) => a.length >= b.length ? a : b).trim();
    }
  }
  
  return title.trim();
}

// ============================================================
// ?ºÌïëÎ™??¥Î¶Ñ Ï∂îÏ∂ú
// ============================================================

/**
 * ?ºÌïëÎ™??¥Î¶Ñ Ï∂îÏ∂ú
 */
export function getSiteName(doc: Document, url: string): string {
  const ogSiteName = getMetaContent(doc, ['meta[property="og:site_name"]']);
  if (ogSiteName) return ogSiteName;

  try {
    const hostname = new URL(url).hostname;
    return formatHostname(hostname);
  } catch {
    return '';
  }
}

/**
 * ?∏Ïä§?∏Î™Ö ?ïÎ¶¨
 */
function formatHostname(hostname: string): string {
  return hostname
    .replace(/^www\./, '')
    .replace(/\.co\.kr$/, '')
    .replace(/\.com$/, '')
    .replace(/\.net$/, '')
    .replace(/\.kr$/, '')
    .replace(/\.jp$/, '')
    .split('.').pop() || hostname;
}

// ============================================================
// Í∞ÄÍ≤?Ï∂îÏ∂ú
// ============================================================

/**
 * ?ÅÌíà Í∞ÄÍ≤?Ï∂îÏ∂ú
 */
export function getProductPrice(doc: Document): { price: number | null; currency: string } {
  // 1?úÏúÑ: Î©îÌ? ?úÍ∑∏ Í∞ÄÍ≤?  const metaPrice = getMetaContent(doc, [
    'meta[property="product:price:amount"]',
    'meta[property="og:price:amount"]',
  ]);
  const metaCurrency = getMetaContent(doc, [
    'meta[property="product:price:currency"]',
    'meta[property="og:price:currency"]',
  ]);

  if (metaPrice) {
    const price = parsePrice(metaPrice);
    if (price !== null) {
      return { price, currency: metaCurrency || 'KRW' };
    }
  }

  // 2?úÏúÑ: JSON-LD Í∞ÄÍ≤?  const jsonLd = parseJsonLd(doc);
  if (jsonLd?.offers) {
    const offers = Array.isArray(jsonLd.offers) ? jsonLd.offers[0] : jsonLd.offers;
    if (offers?.price) {
      const price = parsePrice(String(offers.price));
      if (price !== null) {
        return { price, currency: offers.priceCurrency || 'KRW' };
      }
    }
  }

  // 3?úÏúÑ: Î≥∏Î¨∏?êÏÑú Í∞ÄÍ≤??çÏä§???åÏã±
  return findPriceInDOM(doc);
}

/**
 * Í∞ÄÍ≤?Î¨∏Ïûê?¥ÏùÑ ?´ÏûêÎ°?Î≥Ä?? */
function parsePrice(priceStr: string): number | null {
  const cleaned = priceStr.replace(/[^0-9.]/g, '');
  const price = parseFloat(cleaned);
  
  return isNaN(price) ? null : Math.round(price);
}

/**
 * DOM?êÏÑú Í∞ÄÍ≤??çÏä§??Ï∞æÍ∏∞
 */
function findPriceInDOM(doc: Document): { price: number | null; currency: string } {
  const priceSelectors = [
    '[class*="price"]',
    '[class*="Price"]',
    '[class*="cost"]',
    '[class*="amount"]',
    '[data-price]',
    '[itemprop="price"]',
    '.product-price',
    '.sale-price',
    '.final-price',
  ];

  const pricePatterns = [
    { regex: /??s*([0-9,]+)/, currency: 'KRW' },
    { regex: /([0-9,]+)\s*??, currency: 'KRW' },
    { regex: /KRW\s*([0-9,]+)/, currency: 'KRW' },
    { regex: /\$\s*([0-9,.]+)/, currency: 'USD' },
    { regex: /USD\s*([0-9,.]+)/, currency: 'USD' },
    { regex: /¬•\s*([0-9,]+)/, currency: 'JPY' },
    { regex: /??s*([0-9,.]+)/, currency: 'EUR' },
  ];

  const priceElements: Array<{ element: Element; fontSize: number; text: string }> = [];

  for (const selector of priceSelectors) {
    const elements = doc.querySelectorAll(selector);
    for (const el of elements) {
      const text = el.textContent || '';
      const style = window.getComputedStyle(el);
      const fontSize = parseFloat(style.fontSize) || 0;
      
      for (const pattern of pricePatterns) {
        if (pattern.regex.test(text)) {
          priceElements.push({ element: el, fontSize, text });
          break;
        }
      }
    }
  }

  priceElements.sort((a, b) => b.fontSize - a.fontSize);

  for (const item of priceElements) {
    for (const pattern of pricePatterns) {
      const match = item.text.match(pattern.regex);
      if (match) {
        const price = parsePrice(match[1]);
        if (price !== null && price > 0) {
          return { price, currency: pattern.currency };
        }
      }
    }
  }

  return { price: null, currency: 'KRW' };
}

// ============================================================
// ?†Ìã∏Î¶¨Ìã∞
// ============================================================

/**
 * ?ÅÎ? URL???àÎ? URLÎ°?Î≥Ä?? */
function resolveUrl(url: string, doc: Document): string {
  if (!url) return '';
  
  if (url.startsWith('http://') || url.startsWith('https://')) {
    return url;
  }
  
  if (url.startsWith('//')) {
    return `https:${url}`;
  }
  
  try {
    const base = doc.baseURI || doc.location?.href || '';
    return new URL(url, base).href;
  } catch {
    return url;
  }
}

// ============================================================
// Î©îÏù∏ ?åÏÑú ?®Ïàò
// ============================================================

/**
 * ?ÑÏû¨ ?òÏù¥ÏßÄ?êÏÑú ?ÅÌíà ?ïÎ≥¥ Ï∂îÏ∂ú
 * Content Script?êÏÑú ?∏Ï∂ú?òÎäî Î©îÏù∏ ?®Ïàò
 */
export function parseProductFromPage(doc: Document = document): ProductData {
  const url = doc.location?.href || '';
  const { price, currency } = getProductPrice(doc);
  const imageUrls = getProductImages(doc);

  return {
    title: getProductTitle(doc) || '?úÎ™© ?ÜÏùå',
    price,
    currency,
    imageUrl: imageUrls[0] || '',
    imageUrls,
    mallName: getSiteName(doc, url) || '?????ÜÏùå',
    url,
  };
}

/**
 * ?òÏù¥ÏßÄÍ∞Ä ?ÅÌíà ?òÏù¥ÏßÄ?∏Ï? Í∞ÑÎã®???êÎã®
 */
export function isProductPage(doc: Document = document): boolean {
  const ogType = getMetaContent(doc, ['meta[property="og:type"]']);
  if (ogType.toLowerCase().includes('product')) {
    return true;
  }

  const jsonLd = parseJsonLd(doc);
  if (jsonLd) {
    return true;
  }

  const { price } = getProductPrice(doc);
  return price !== null;
}

==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\i18n.ts
==========================================
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// ?∏Ïñ¥ Î¶¨ÏÜå??import
import ko from './locales/ko.json';
import en from './locales/en.json';
import ja from './locales/ja.json';
import zh from './locales/zh.json';

// ÏßÄ???∏Ïñ¥ Î™©Î°ù
export const supportedLanguages = ['ko', 'en', 'ja', 'zh'] as const;
export type SupportedLanguage = typeof supportedLanguages[number];

// ?∏Ïñ¥Î≥??úÏãú ?¥Î¶Ñ
export const languageNames: Record<SupportedLanguage, string> = {
  ko: '?úÍµ≠??,
  en: 'English',
  ja: '?•Êú¨Ë™?,
  zh: '‰∏?ñá',
};

// Î¶¨ÏÜå??Î≤àÎì§
const resources = {
  ko: { translation: ko },
  en: { translation: en },
  ja: { translation: ja },
  zh: { translation: zh },
};

// i18n Ï¥àÍ∏∞??
i18n
  // Î∏åÎùº?∞Ï? ?∏Ïñ¥ ?êÎèô Í∞êÏ? ?åÎü¨Í∑∏Ïù∏
  .use(LanguageDetector)
  // React Î∞îÏù∏??
  .use(initReactI18next)
  // Ï¥àÍ∏∞???§Ï†ï
  .init({
    resources,
    fallbackLng: 'en', // Í∏∞Î≥∏ ?∏Ïñ¥ (ÏßÄ?êÌïòÏßÄ ?äÎäî ?∏Ïñ¥????
    supportedLngs: supportedLanguages,
    
    // ?∏Ïñ¥ Í∞êÏ? ?§Ï†ï
    detection: {
      // Í∞êÏ? ?úÏÑú: localStorage ??navigator ??htmlTag
      order: ['localStorage', 'navigator', 'htmlTag'],
      // Í∞êÏ????∏Ïñ¥ Ï∫êÏãú ?ÑÏπò
      caches: ['localStorage'],
      // localStorage ???¥Î¶Ñ
      lookupLocalStorage: 'pockest-language',
    },

    interpolation: {
      escapeValue: false, // React??XSS Î≥¥Ìò∏Í∞Ä ?¥Ïû•?òÏñ¥ ?àÏùå
    },

    // ?îÎ≤ÑÍ∑?Î™®Îìú (Í∞úÎ∞ú ?òÍ≤Ω?êÏÑúÎß?
    debug: import.meta.env.DEV,

    // React Suspense ?¨Ïö©
    react: {
      useSuspense: false,
    },
  });

// ?∏Ïñ¥ Î≥ÄÍ≤??®Ïàò (Ïª¥Ìè¨?åÌä∏ ?∏Î??êÏÑú???¨Ïö© Í∞Ä??
export const changeLanguage = (lng: SupportedLanguage) => {
  return i18n.changeLanguage(lng);
};

// ?ÑÏû¨ ?∏Ïñ¥ Í∞Ä?∏Ïò§Í∏?
export const getCurrentLanguage = (): SupportedLanguage => {
  const current = i18n.language;
  // 'ko-KR' Í∞ôÏ? ?ïÏãù??'ko'Î°?Î≥Ä??
  const shortLang = current?.split('-')[0] as SupportedLanguage;
  return supportedLanguages.includes(shortLang) ? shortLang : 'en';
};

export default i18n;




==========================================
FILE PATH: D:\@@«¡∑Œ¡ß∆Æ\project\Pockest\src\vite-env.d.ts
==========================================
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_SUPABASE_URL: string;
  readonly VITE_SUPABASE_ANON_KEY: string;
  readonly VITE_APP_NAME: string;
  readonly VITE_APP_VERSION: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}





